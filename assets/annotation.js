// Namespace
var annotation = {};


(function(d){function u(g,a){var b=typeof g[a];return"function"==b||!("object"!=b||!g[a])||"unknown"==b}function w(g,a){return!("object"!=typeof g[a]||!g[a])}function t(g,a){return"undefined"!=typeof g[a]}function x(g){return function(a,b){for(var c=b.length;c--;)if(!g(a,b[c]))return!1;return!0}}function D(g){return g&&f(g,h)&&m(g,a)}function y(g){return w(g,"body")?g.body:g.getElementsByTagName("body")[0]}function z(g){w(window,"console")&&u(window.console,"log")&&window.console.log(g)}function v(a){g.initialized=
!0;g.supported=!1;a="Rangy is not supported on this page in your browser. Reason: "+a;g.config.alertOnFail?window.alert(a):z(a)}function A(){if(!g.initialized){var a,h=!1,d=!1;u(document,"createRange")&&(a=document.createRange(),f(a,c)&&m(a,b)&&(h=!0),a.detach());if((a=y(document))&&"body"==a.nodeName.toLowerCase())if(a&&u(a,"createTextRange")&&(a=a.createTextRange(),D(a)&&(d=!0)),h||d){g.initialized=!0;g.features={implementsDomRange:h,implementsTextRange:d};var p,I;for(I in E)(p=E[I])instanceof C&&
p.init(p,g);d=0;for(p=R.length;d<p;++d)try{R[d](g)}catch(O){h="Rangy init listener threw an exception. Continuing. Detail: "+(O.message||O.description||String(O)),z(h)}}else v("Neither Range nor TextRange are available");else v("No body element found")}}function C(a,g,b){this.name=a;this.dependencies=g;this.supported=this.initialized=!1;this.initializer=b}function r(a,b,c,f){a=new C(b,c,function(a){if(!a.initialized){a.initialized=!0;try{f(g,a),a.supported=!0}catch(c){z("Module '"+b+"' failed to load: "+
(c.message||c.description||String(c)))}}});E[b]=a}function q(){}var k="function"==typeof d.define&&d.define.amd,b="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" "),c="setStart setStartBefore setStartAfter setEnd setEndBefore setEndAfter collapse selectNode selectNodeContents compareBoundaryPoints deleteContents extractContents cloneContents insertNode surroundContents cloneRange toString detach".split(" "),a="boundingHeight boundingLeft boundingTop boundingWidth htmlText text".split(" "),
h="collapse compareEndPoints duplicate moveToElementText parentElement select setEndPoint getBoundingClientRect".split(" "),f=x(u),p=x(w),m=x(t),E={},g={version:"1.3alpha.804",initialized:!1,supported:!0,util:{isHostMethod:u,isHostObject:w,isHostProperty:t,areHostMethods:f,areHostObjects:p,areHostProperties:m,isTextRange:D,getBody:y},features:{},modules:E,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1}};g.fail=v;g.warn=function(a){a="Rangy warning: "+a;g.config.alertOnWarn?window.alert(a):
z(a)};({}).hasOwnProperty?g.util.extend=function(a,b,c){var f,h,d;for(d in b)b.hasOwnProperty(d)&&(f=a[d],h=b[d],c&&null!==f&&"object"==typeof f&&null!==h&&"object"==typeof h&&g.util.extend(f,h,!0),a[d]=h);return a}:v("hasOwnProperty not supported");(function(){var a=document.createElement("div");a.appendChild(document.createElement("span"));var b=[].slice,c;try{1==b.call(a.childNodes,0)[0].nodeType&&(c=function(a){return b.call(a,0)})}catch(f){}c||(c=function(a){for(var g=[],b=0,c=a.length;b<c;++b)g[b]=
a[b];return g});g.util.toArray=c})();var I;u(document,"addEventListener")?I=function(a,g,b){a.addEventListener(g,b,!1)}:u(document,"attachEvent")?I=function(a,g,b){a.attachEvent("on"+g,b)}:v("Document does not have required addEventListener or attachEvent method");g.util.addListener=I;var R=[];g.init=A;g.addInitListener=function(a){g.initialized?a(g):R.push(a)};var O=[];g.addCreateMissingNativeApiListener=function(a){O.push(a)};g.createMissingNativeApi=function(a){a=a||window;A();for(var g=0,b=O.length;g<
b;++g)O[g](a)};C.prototype={init:function(a){a=this.dependencies||[];for(var g=0,b=a.length,c,f;g<b;++g){f=a[g];c=E[f];if(!(c&&c instanceof C))throw Error("required module '"+f+"' not found");c.init();if(!c.supported)throw Error("required module '"+f+"' not supported");}this.initializer(this)},fail:function(a){this.initialized=!0;this.supported=!1;throw Error("Module '"+this.name+"' failed to load: "+a);},warn:function(a){g.warn("Module "+this.name+": "+a)},deprecationNotice:function(a,b){g.warn("DEPRECATED: "+
a+" in module "+this.name+"is deprecated. Please use "+b+" instead")},createError:function(a){return Error("Error in Rangy "+this.name+" module: "+a)}};g.createModule=function(a){var g,b;2==arguments.length?(g=arguments[1],b=[]):(g=arguments[2],b=arguments[1]);r(!1,a,b,g)};g.createCoreModule=function(a,g,b){r(!0,a,g,b)};g.RangePrototype=q;g.rangePrototype=new q;g.selectionPrototype=new function(){};var B=!1,p=function(a){B||(B=!0,g.initialized||A())};"undefined"==typeof window?v("No window found"):
"undefined"==typeof document?v("No document found"):(u(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",p,!1),I(window,"load",p),k&&d.define(function(){g.amd=!0;return g}),d.rangy=g)})(this);
rangy.createCoreModule("DomUtil",[],function(d,u){function w(a){for(var b=0;a=a.previousSibling;)++b;return b}function t(a,b){var c=[],f;for(f=a;f;f=f.parentNode)c.push(f);for(f=b;f;f=f.parentNode)if(p(c,f))return f;return null}function x(a,b,c){for(b=c?b:b.parentNode;b;){if(b===a)return!0;b=b.parentNode}return!1}function D(a,b,c){for(c=c?a:a.parentNode;c;){a=c.parentNode;if(a===b)return c;c=a}return null}function y(a){a=a.nodeType;return 3==a||4==a||8==a}function z(a,b){var c=b.nextSibling,f=b.parentNode;
c?f.insertBefore(a,c):f.appendChild(a);return a}function v(a){if(9==a.nodeType)return a;if("undefined"!=typeof a.ownerDocument)return a.ownerDocument;if("undefined"!=typeof a.document)return a.document;if(a.parentNode)return v(a.parentNode);throw u.createError("getDocument: no document found for node");}function A(a){a=v(a);if("undefined"!=typeof a.defaultView)return a.defaultView;if("undefined"!=typeof a.parentWindow)return a.parentWindow;throw u.createError("Cannot get a window object for node");
}function C(a){if("undefined"!=typeof a.contentDocument)return a.contentDocument;if("undefined"!=typeof a.contentWindow)return a.contentWindow.document;throw u.createError("getIframeDocument: No Document object found for iframe element");}function r(a){return a&&h.isHostMethod(a,"setTimeout")&&h.isHostObject(a,"document")}function q(a){try{return a.parentNode,!1}catch(b){return!0}}function k(a){return a?m&&q(a)?"[Broken node]":y(a)?'"'+a.data+'"':1==a.nodeType?"<"+a.nodeName+(a.id?' id="'+a.id+'"':
"")+">["+w(a)+"]["+a.childNodes.length+"]["+(a.innerHTML||"[innerHTML not supported]").slice(0,25)+"]":a.nodeName:"[No node]"}function b(a){this._next=this.root=a}function c(a,b){this.node=a;this.offset=b}function a(a){this.code=this[a];this.codeName=a;this.message="DOMException: "+this.codeName}var h=d.util;h.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||u.fail("document missing a Node creation method");h.isHostMethod(document,"getElementsByTagName")||u.fail("document missing getElementsByTagName method");
var f=document.createElement("div");h.areHostMethods(f,["insertBefore","appendChild","cloneNode"])||u.fail("Incomplete Element implementation");h.isHostProperty(f,"innerHTML")||u.fail("Element is missing innerHTML property");f=document.createTextNode("test");h.areHostMethods(f,["splitText","deleteData","insertData","appendData","cloneNode"])||u.fail("Incomplete Text Node implementation");var p=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1},m=!1;(function(){var a=document.createElement("b");
a.innerHTML="1";var b=a.firstChild;a.innerHTML="<br>";m=q(b);d.features.crashyTextNodes=m})();var E;"undefined"!=typeof window.getComputedStyle?E=function(a,b){return A(a).getComputedStyle(a,null)[b]}:"undefined"!=typeof document.documentElement.currentStyle?E=function(a,b){return a.currentStyle[b]}:u.fail("No means of obtaining computed style properties found");b.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next,b;if(this._current){b=a.firstChild;
if(!b)for(b=null;a!==this.root&&!(b=a.nextSibling);)a=a.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=null}};c.prototype={equals:function(a){return!!a&&this.node===a.node&&this.offset==a.offset},inspect:function(){return"[DomPosition("+k(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}};a.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,
INVALID_STATE_ERR:11};a.prototype.toString=function(){return this.message};d.dom={arrayContains:p,isHtmlNamespace:function(a){var b;return"undefined"==typeof a.namespaceURI||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==b},parentElement:function(a){a=a.parentNode;return 1==a.nodeType?a:null},getNodeIndex:w,getNodeLength:function(a){switch(a.nodeType){case 7:case 10:return 0;case 3:case 8:return a.length;default:return a.childNodes.length}},getCommonAncestor:t,isAncestorOf:x,isOrIsAncestorOf:function(a,
b){return x(a,b,!0)},getClosestAncestorIn:D,isCharacterDataNode:y,isTextOrCommentNode:function(a){if(!a)return!1;a=a.nodeType;return 3==a||8==a},insertAfter:z,splitDataNode:function(a,b,c){var f=a.cloneNode(!1);f.deleteData(0,b);a.deleteData(b,a.length-b);z(f,a);if(c)for(var h=0,d;d=c[h++];)d.node==a&&d.offset>b?(d.node=f,d.offset-=b):d.node==a.parentNode&&d.offset>w(a)&&++d.offset;return f},getDocument:v,getWindow:A,getIframeWindow:function(a){if("undefined"!=typeof a.contentWindow)return a.contentWindow;
if("undefined"!=typeof a.contentDocument)return a.contentDocument.defaultView;throw u.createError("getIframeWindow: No Window object found for iframe element");},getIframeDocument:C,getBody:h.getBody,isWindow:r,getContentDocument:function(a,b,c){var f;a?h.isHostProperty(a,"nodeType")?f=1==a.nodeType&&"iframe"==a.tagName.toLowerCase()?C(a):v(a):r(a)&&(f=a.document):f=document;if(!f)throw b.createError(c+"(): Parameter must be a Window object or DOM node");return f},getRootContainer:function(a){for(var b;b=
a.parentNode;)a=b;return a},comparePoints:function(a,b,c,f){var h;if(a==c)return b===f?0:b<f?-1:1;if(h=D(c,a,!0))return b<=w(h)?-1:1;if(h=D(a,c,!0))return w(h)<f?-1:1;b=t(a,c);if(!b)throw Error("comparePoints error: nodes have no common ancestor");a=a===b?b:D(a,b,!0);c=c===b?b:D(c,b,!0);if(a===c)throw u.createError("comparePoints got to case 4 and childA and childB are the same!");for(b=b.firstChild;b;){if(b===a)return-1;if(b===c)return 1;b=b.nextSibling}},isBrokenNode:q,inspectNode:k,getComputedStyleProperty:E,
fragmentFromNodeChildren:function(a){for(var b=v(a).createDocumentFragment(),c;c=a.firstChild;)b.appendChild(c);return b},createIterator:function(a){return new b(a)},DomPosition:c};d.DOMException=a});
rangy.createCoreModule("DomRange",["DomUtil"],function(d,u){function w(a,e){return 3!=a.nodeType&&(Z(a,e.startContainer)||Z(a,e.endContainer))}function t(a){return a.document||ea(a.startContainer)}function x(a){return new l(a.parentNode,$(a))}function D(a){return new l(a.parentNode,$(a)+1)}function y(a,e,b){var n=11==a.nodeType?a.firstChild:a;K(e)?b==e.length?F.insertAfter(a,e):e.parentNode.insertBefore(a,0==b?e:T(e,b)):b>=e.childNodes.length?e.appendChild(a):e.insertBefore(a,e.childNodes[b]);return n}
function z(a,e,b){H(a);H(e);if(t(e)!=t(a))throw new J("WRONG_DOCUMENT_ERR");var n=L(a.startContainer,a.startOffset,e.endContainer,e.endOffset);a=L(a.endContainer,a.endOffset,e.startContainer,e.startOffset);return b?0>=n&&0<=a:0>n&&0<a}function v(a){for(var e,b,n=t(a.range).createDocumentFragment();b=a.next();){e=a.isPartiallySelectedSubtree();b=b.cloneNode(!e);e&&(e=a.getSubtreeIterator(),b.appendChild(v(e)),e.detach(!0));if(10==b.nodeType)throw new J("HIERARCHY_REQUEST_ERR");n.appendChild(b)}return n}
function A(a,e,b){var n,s;for(b=b||{stop:!1};n=a.next();)if(a.isPartiallySelectedSubtree())if(!1===e(n)){b.stop=!0;break}else{if(n=a.getSubtreeIterator(),A(n,e,b),n.detach(!0),b.stop)break}else for(n=F.createIterator(n);s=n.next();)if(!1===e(s)){b.stop=!0;return}}function C(a){for(var e;a.next();)a.isPartiallySelectedSubtree()?(e=a.getSubtreeIterator(),C(e),e.detach(!0)):a.remove()}function r(a){for(var e,b=t(a.range).createDocumentFragment(),n;e=a.next();){a.isPartiallySelectedSubtree()?(e=e.cloneNode(!1),
n=a.getSubtreeIterator(),e.appendChild(r(n)),n.detach(!0)):a.remove();if(10==e.nodeType)throw new J("HIERARCHY_REQUEST_ERR");b.appendChild(e)}return b}function q(a,e,n){var s=!(!e||!e.length),l,G=!!n;s&&(l=new RegExp("^("+e.join("|")+")$"));var c=[];A(new b(a,!1),function(e){if(!s||l.test(e.nodeType))if(!G||n(e)){var b=a.startContainer;e==b&&K(b)&&a.startOffset==b.length||(b=a.endContainer,e==b&&K(b)&&0==a.endOffset||c.push(e))}});return c}function k(a){return"["+("undefined"==typeof a.getName?"Range":
a.getName())+"("+F.inspectNode(a.startContainer)+":"+a.startOffset+", "+F.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function b(a,e){this.range=a;this.clonePartiallySelectedTextNodes=e;if(!a.collapsed){this.sc=a.startContainer;this.so=a.startOffset;this.ec=a.endContainer;this.eo=a.endOffset;var b=a.commonAncestorContainer;this.sc===this.ec&&K(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==b||K(this.sc)?aa(this.sc,b,!0):
this.sc.childNodes[this.so],this._last=this.ec!==b||K(this.ec)?aa(this.ec,b,!0):this.ec.childNodes[this.eo-1])}}function c(a){this.code=this[a];this.codeName=a;this.message="RangeException: "+this.codeName}function a(a){return function(e,b){for(var n,s=b?e:e.parentNode;s;){n=s.nodeType;if(fa(a,n))return s;s=s.parentNode}return null}}function h(a,e){if(ka(a,e))throw new c("INVALID_NODE_TYPE_ERR");}function f(a){if(!a.startContainer)throw new J("INVALID_STATE_ERR");}function p(a,e){if(!fa(e,a.nodeType))throw new c("INVALID_NODE_TYPE_ERR");
}function m(a,e){if(0>e||e>(K(a)?a.length:a.childNodes.length))throw new J("INDEX_SIZE_ERR");}function E(a,e){if(G(a,!0)!==G(e,!0))throw new J("WRONG_DOCUMENT_ERR");}function g(a){if(ga(a,!0))throw new J("NO_MODIFICATION_ALLOWED_ERR");}function I(a,e){if(!a)throw new J(e);}function R(a){return Y&&F.isBrokenNode(a)||!fa(s,a.nodeType)&&!G(a,!0)}function O(a,e){return e<=(K(a)?a.length:a.childNodes.length)}function B(a){return!!a.startContainer&&!!a.endContainer&&!R(a.startContainer)&&!R(a.endContainer)&&
O(a.startContainer,a.startOffset)&&O(a.endContainer,a.endOffset)}function H(a){f(a);if(!B(a))throw Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")");}function N(a,e){H(a);var b=a.startContainer,n=a.startOffset,s=a.endContainer,l=a.endOffset,G=b===s;K(s)&&0<l&&l<s.length&&T(s,l,e);K(b)&&0<n&&n<b.length&&(b=T(b,n,e),G?(l-=n,s=b):s==b.parentNode&&l>=$(b)&&l++,n=0);a.setStartAndEnd(b,n,s,l)}function V(a){a.START_TO_START=0;a.START_TO_END=1;a.END_TO_END=2;a.END_TO_START=
3;a.NODE_BEFORE=0;a.NODE_AFTER=1;a.NODE_BEFORE_AND_AFTER=2;a.NODE_INSIDE=3}function P(a){V(a);V(a.prototype)}function Q(a,e){return function(){H(this);var n=this.startContainer,s=this.startOffset,l=this.commonAncestorContainer,G=new b(this,!0);n!==l&&(n=aa(n,l,!0),s=D(n),n=s.node,s=s.offset);A(G,g);G.reset();l=a(G);G.detach();e(this,n,s,n,s);return l}}function W(a,e,n){function l(a,e){return function(b){f(this);p(b,da);p(U(b),s);b=(a?x:D)(b);(e?G:c)(this,b.node,b.offset)}}function G(a,b,n){var s=
a.endContainer,l=a.endOffset;if(b!==a.startContainer||n!==a.startOffset){if(U(b)!=U(s)||1==L(b,n,s,l))s=b,l=n;e(a,b,n,s,l)}}function c(a,b,n){var s=a.startContainer,l=a.startOffset;if(b!==a.endContainer||n!==a.endOffset){if(U(b)!=U(s)||-1==L(b,n,s,l))s=b,l=n;e(a,s,l,b,n)}}var ga=function(){};ga.prototype=d.rangePrototype;a.prototype=new ga;X.extend(a.prototype,{setStart:function(a,e){f(this);h(a,!0);m(a,e);G(this,a,e)},setEnd:function(a,e){f(this);h(a,!0);m(a,e);c(this,a,e)},setStartAndEnd:function(){f(this);
var a=arguments,b=a[0],n=a[1],s=b,l=n;switch(a.length){case 3:l=a[2];break;case 4:s=a[2],l=a[3]}e(this,b,n,s,l)},setBoundary:function(a,e,b){this["set"+(b?"Start":"End")](a,e)},setStartBefore:l(!0,!0),setStartAfter:l(!1,!0),setEndBefore:l(!0,!1),setEndAfter:l(!1,!1),collapse:function(a){H(this);a?e(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):e(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){f(this);h(a,!0);
e(this,a,0,a,ba(a))},selectNode:function(a){f(this);h(a,!1);p(a,da);var b=x(a);a=D(a);e(this,b.node,b.offset,a.node,a.offset)},extractContents:Q(r,e),deleteContents:Q(C,e),canSurroundContents:function(){H(this);g(this.startContainer);g(this.endContainer);var a=new b(this,!0),e=a._first&&w(a._first,this)||a._last&&w(a._last,this);a.detach();return!e},detach:function(){n(this)},splitBoundaries:function(){N(this)},splitBoundariesPreservingPositions:function(a){N(this,a)},normalizeBoundaries:function(){H(this);
var a=this.startContainer,b=this.startOffset,n=this.endContainer,s=this.endOffset,l=function(a){var e=a.nextSibling;e&&e.nodeType==a.nodeType&&(n=a,s=a.length,a.appendData(e.data),e.parentNode.removeChild(e))},G=function(e){var l=e.previousSibling;if(l&&l.nodeType==e.nodeType){a=e;var G=e.length;b=l.length;e.insertData(0,l.data);l.parentNode.removeChild(l);a==n?(s+=b,n=a):n==e.parentNode&&(l=$(e),s==l?(n=e,s=G):s>l&&s--)}},c=!0;K(n)?n.length==s&&l(n):(0<s&&(c=n.childNodes[s-1])&&K(c)&&l(c),c=!this.collapsed);
c?K(a)?0==b&&G(a):b<a.childNodes.length&&(l=a.childNodes[b])&&K(l)&&G(l):(a=n,b=s);e(this,a,b,n,s)},collapseToPoint:function(a,e){f(this);h(a,!0);m(a,e);this.setStartAndEnd(a,e)}});P(a)}function ca(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset;a.commonAncestorContainer=a.collapsed?a.startContainer:F.getCommonAncestor(a.startContainer,a.endContainer)}function M(a,e,b,n,s){a.startContainer=e;a.startOffset=b;a.endContainer=n;a.endOffset=s;a.document=F.getDocument(e);ca(a)}
function S(a){this.startContainer=a;this.startOffset=0;this.endContainer=a;this.endOffset=0;this.document=a;ca(this)}var F=d.dom,X=d.util,l=F.DomPosition,J=d.DOMException,K=F.isCharacterDataNode,$=F.getNodeIndex,Z=F.isOrIsAncestorOf,ea=F.getDocument,L=F.comparePoints,T=F.splitDataNode,aa=F.getClosestAncestorIn,ba=F.getNodeLength,fa=F.arrayContains,U=F.getRootContainer,Y=d.features.crashyTextNodes;b.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=
null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;a&&(this._next=a!==this._last?a.nextSibling:null,K(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so)));return a},remove:function(){var a=this._current,e,b;!K(a)||a!==this.sc&&a!==this.ec?a.parentNode&&a.parentNode.removeChild(a):(e=a===this.sc?this.so:0,b=
a===this.ec?this.eo:a.length,e!=b&&a.deleteData(e,b-e))},isPartiallySelectedSubtree:function(){return w(this._current,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse(!1);else{a=new S(t(this.range));var e=this._current,n=e,s=0,l=e,G=ba(e);Z(e,this.sc)&&(n=this.sc,s=this.so);Z(e,this.ec)&&(l=this.ec,G=this.eo);M(a,n,s,l,G)}return new b(a,this.clonePartiallySelectedTextNodes)},detach:function(a){a&&this.range.detach();this.range=
this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};c.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};c.prototype.toString=function(){return this.message};var da=[1,3,4,5,7,8,10],s=[2,9,11],e=[1,3,4,5,7,8,10,11],n=[1,3,4,5,7,8],G=a([9,11]),ga=a([5,6,10,12]),ka=a([6,10,12]),ja=document.createElement("style"),ha=!1;try{ja.innerHTML="<b>x</b>",ha=3==ja.firstChild.nodeType}catch(la){}d.features.htmlParsingConforms=ha;var ia="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" ");
X.extend(d.rangePrototype,{compareBoundaryPoints:function(a,e){H(this);E(this.startContainer,e.startContainer);var b=3==a||0==a?"start":"end",n=1==a||0==a?"start":"end";return L(this[b+"Container"],this[b+"Offset"],e[n+"Container"],e[n+"Offset"])},insertNode:function(a){H(this);p(a,e);g(this.startContainer);if(Z(a,this.startContainer))throw new J("HIERARCHY_REQUEST_ERR");a=y(a,this.startContainer,this.startOffset);this.setStartBefore(a)},cloneContents:function(){H(this);var a,e;if(this.collapsed)return t(this).createDocumentFragment();
if(this.startContainer===this.endContainer&&K(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),e=t(this).createDocumentFragment(),e.appendChild(a),e;e=new b(this,!0);a=v(e);e.detach();return a},canSurroundContents:function(){H(this);g(this.startContainer);g(this.endContainer);var a=new b(this,!0),e=a._first&&w(a._first,this)||a._last&&w(a._last,this);a.detach();return!e},surroundContents:function(a){p(a,n);if(!this.canSurroundContents())throw new c("BAD_BOUNDARYPOINTS_ERR");
var e=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);y(a,this.startContainer,this.startOffset);a.appendChild(e);this.selectNode(a)},cloneRange:function(){H(this);for(var a=new S(t(this)),e=ia.length,b;e--;)b=ia[e],a[b]=this[b];return a},toString:function(){H(this);var a=this.startContainer;if(a===this.endContainer&&K(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var e=[],a=new b(this,!0);A(a,function(a){3!=a.nodeType&&
4!=a.nodeType||e.push(a.data)});a.detach();return e.join("")},compareNode:function(a){H(this);var e=a.parentNode,b=$(a);if(!e)throw new J("NOT_FOUND_ERR");a=this.comparePoint(e,b);e=this.comparePoint(e,b+1);return 0>a?0<e?2:0:0<e?1:3},comparePoint:function(a,e){H(this);I(a,"HIERARCHY_REQUEST_ERR");E(a,this.startContainer);return 0>L(a,e,this.startContainer,this.startOffset)?-1:0<L(a,e,this.endContainer,this.endOffset)?1:0},createContextualFragment:ha?function(a){var e=this.startContainer,b=ea(e);
if(!e)throw new J("INVALID_STATE_ERR");var n=null;1==e.nodeType?n=e:K(e)&&(n=F.parentElement(e));n=null===n||"HTML"==n.nodeName&&F.isHtmlNamespace(ea(n).documentElement)&&F.isHtmlNamespace(n)?b.createElement("body"):n.cloneNode(!1);n.innerHTML=a;return F.fragmentFromNodeChildren(n)}:function(a){f(this);var e=t(this).createElement("body");e.innerHTML=a;return F.fragmentFromNodeChildren(e)},toHtml:function(){H(this);var a=this.commonAncestorContainer.parentNode.cloneNode(!1);a.appendChild(this.cloneContents());
return a.innerHTML},intersectsNode:function(a,e){H(this);I(a,"NOT_FOUND_ERR");if(ea(a)!==t(this))return!1;var b=a.parentNode,n=$(a);I(b,"NOT_FOUND_ERR");var s=L(b,n,this.endContainer,this.endOffset),b=L(b,n+1,this.startContainer,this.startOffset);return e?0>=s&&0<=b:0>s&&0<b},isPointInRange:function(a,e){H(this);I(a,"HIERARCHY_REQUEST_ERR");E(a,this.startContainer);return 0<=L(a,e,this.startContainer,this.startOffset)&&0>=L(a,e,this.endContainer,this.endOffset)},intersectsRange:function(a){return z(this,
a,!1)},intersectsOrTouchesRange:function(a){return z(this,a,!0)},intersection:function(a){if(this.intersectsRange(a)){var e=L(this.startContainer,this.startOffset,a.startContainer,a.startOffset),b=L(this.endContainer,this.endOffset,a.endContainer,a.endOffset),n=this.cloneRange();-1==e&&n.setStart(a.startContainer,a.startOffset);1==b&&n.setEnd(a.endContainer,a.endOffset);return n}return null},union:function(a){if(this.intersectsOrTouchesRange(a)){var e=this.cloneRange();-1==L(a.startContainer,a.startOffset,
this.startContainer,this.startOffset)&&e.setStart(a.startContainer,a.startOffset);1==L(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&e.setEnd(a.endContainer,a.endOffset);return e}throw new c("Ranges do not intersect");},containsNode:function(a,e){return e?this.intersectsNode(a,!1):3==this.compareNode(a)},containsNodeContents:function(a){return 0<=this.comparePoint(a,0)&&0>=this.comparePoint(a,ba(a))},containsRange:function(a){var e=this.intersection(a);return null!==e&&a.equals(e)},
containsNodeText:function(a){var e=this.cloneRange();e.selectNode(a);var b=e.getNodes([3]);return 0<b.length?(e.setStart(b[0],0),a=b.pop(),e.setEnd(a,a.length),a=this.containsRange(e),e.detach(),a):this.containsNodeContents(a)},getNodes:function(a,e){H(this);return q(this,a,e)},getDocument:function(){return t(this)},collapseBefore:function(a){f(this);this.setEndBefore(a);this.collapse(!1)},collapseAfter:function(a){f(this);this.setStartAfter(a);this.collapse(!0)},getBookmark:function(a){var e=t(this),
b=d.createRange(e);a=a||F.getBody(e);b.selectNodeContents(a);var e=this.intersection(b),n=0,s=0;e&&(b.setEnd(e.startContainer,e.startOffset),n=b.toString().length,s=n+e.toString().length,b.detach());return{start:n,end:s,containerNode:a}},moveToBookmark:function(a){var e=a.containerNode,b=0;this.setStart(e,0);this.collapse(!0);for(var e=[e],n,s=!1,l=!1,G,c;!l&&(n=e.pop());)if(3==n.nodeType)G=b+n.length,!s&&a.start>=b&&a.start<=G&&(this.setStart(n,a.start-b),s=!0),s&&a.end>=b&&a.end<=G&&(this.setEnd(n,
a.end-b),l=!0),b=G;else for(c=n.childNodes,G=c.length;G--;)e.push(c[G])},getName:function(){return"DomRange"},equals:function(a){return S.rangesEqual(this,a)},isValid:function(){return B(this)},inspect:function(){return k(this)}});W(S,M,function(a){f(a);a.startContainer=a.startOffset=a.endContainer=a.endOffset=a.document=null;a.collapsed=a.commonAncestorContainer=null});X.extend(S,{rangeProperties:ia,RangeIterator:b,copyComparisonConstants:P,createPrototypeRange:W,inspect:k,getRangeDocument:t,rangesEqual:function(a,
e){return a.startContainer===e.startContainer&&a.startOffset===e.startOffset&&a.endContainer===e.endContainer&&a.endOffset===e.endOffset}});d.DomRange=S;d.RangeException=c});
rangy.createCoreModule("WrappedRange",["DomRange"],function(d,u){var w,t,x=d.dom,D=d.util,y=x.DomPosition,z=d.DomRange,v=x.getBody,A=x.getContentDocument,C=x.isCharacterDataNode;d.features.implementsDomRange&&function(){function b(b){for(var c=a.length,f;c--;)f=a[c],b[f]=b.nativeRange[f];b.collapsed=b.startContainer===b.endContainer&&b.startOffset===b.endOffset}var c,a=z.rangeProperties,h;w=function(a){if(!a)throw u.createError("WrappedRange: Range must be specified");this.nativeRange=a;b(this)};
z.createPrototypeRange(w,function(a,b,c,f,h){var d=a.startContainer!==b||a.startOffset!=c,g=a.endContainer!==f||a.endOffset!=h,p=!a.equals(a.nativeRange);if(d||g||p)a.setEnd(f,h),a.setStart(b,c)},function(b){b.nativeRange.detach();b.detached=!0;for(var c=a.length;c--;)b[a[c]]=null});c=w.prototype;c.selectNode=function(a){this.nativeRange.selectNode(a);b(this)};c.cloneContents=function(){return this.nativeRange.cloneContents()};c.surroundContents=function(a){this.nativeRange.surroundContents(a);b(this)};
c.collapse=function(a){this.nativeRange.collapse(a);b(this)};c.cloneRange=function(){return new w(this.nativeRange.cloneRange())};c.refresh=function(){b(this)};c.toString=function(){return this.nativeRange.toString()};var f=document.createTextNode("test");v(document).appendChild(f);var p=document.createRange();p.setStart(f,0);p.setEnd(f,0);try{p.setStart(f,1),c.setStart=function(a,c){this.nativeRange.setStart(a,c);b(this)},c.setEnd=function(a,c){this.nativeRange.setEnd(a,c);b(this)},h=function(a){return function(c){this.nativeRange[a](c);
b(this)}}}catch(m){c.setStart=function(a,c){try{this.nativeRange.setStart(a,c)}catch(f){this.nativeRange.setEnd(a,c),this.nativeRange.setStart(a,c)}b(this)},c.setEnd=function(a,c){try{this.nativeRange.setEnd(a,c)}catch(f){this.nativeRange.setStart(a,c),this.nativeRange.setEnd(a,c)}b(this)},h=function(a,c){return function(f){try{this.nativeRange[a](f)}catch(h){this.nativeRange[c](f),this.nativeRange[a](f)}b(this)}}}c.setStartBefore=h("setStartBefore","setEndBefore");c.setStartAfter=h("setStartAfter",
"setEndAfter");c.setEndBefore=h("setEndBefore","setStartBefore");c.setEndAfter=h("setEndAfter","setStartAfter");c.selectNodeContents=function(a){this.setStartAndEnd(a,0,x.getNodeLength(a))};p.selectNodeContents(f);p.setEnd(f,3);h=document.createRange();h.selectNodeContents(f);h.setEnd(f,4);h.setStart(f,2);-1==p.compareBoundaryPoints(p.START_TO_END,h)&&1==p.compareBoundaryPoints(p.END_TO_START,h)?c.compareBoundaryPoints=function(a,b){b=b.nativeRange||b;a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&
(a=b.START_TO_END);return this.nativeRange.compareBoundaryPoints(a,b)}:c.compareBoundaryPoints=function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)};var k=document.createElement("div");k.innerHTML="123";var g=k.firstChild,r=v(document);r.appendChild(k);p.setStart(g,1);p.setEnd(g,2);p.deleteContents();"13"==g.data&&(c.deleteContents=function(){this.nativeRange.deleteContents();b(this)},c.extractContents=function(){var a=this.nativeRange.extractContents();b(this);return a});
r.removeChild(k);r=null;D.isHostMethod(p,"createContextualFragment")&&(c.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)});v(document).removeChild(f);p.detach();h.detach();c.getName=function(){return"WrappedRange"};d.WrappedRange=w;d.createNativeRange=function(a){a=A(a,u,"createNativeRange");return a.createRange()}}();if(d.features.implementsTextRange){var r=function(b,c,a,h,f){var d=b.duplicate();d.collapse(a);var m=d.parentElement();x.isOrIsAncestorOf(c,
m)||(m=c);if(!m.canHaveHTML)return m=new y(m.parentNode,x.getNodeIndex(m)),{boundaryPosition:m,nodeInfo:{nodeIndex:m.offset,containerElement:m.node}};c=x.getDocument(m).createElement("span");c.parentNode&&c.parentNode.removeChild(c);var k,g=a?"StartToStart":"StartToEnd",r=f&&f.containerElement==m?f.nodeIndex:0,q=m.childNodes.length,t=q;for(f=t;;){f==q?m.appendChild(c):m.insertBefore(c,m.childNodes[f]);d.moveToElementText(c);k=d.compareEndPoints(g,b);if(0==k||r==t)break;else if(-1==k)if(t==r+1)break;
else r=f;else t=t==r+1?r:f;f=Math.floor((r+t)/2);m.removeChild(c)}g=c.nextSibling;if(-1==k&&g&&C(g)){d.setEndPoint(a?"EndToStart":"EndToEnd",b);if(/[\r\n]/.test(g.data))for(a=d.duplicate(),h=a.text.replace(/\r\n/g,"\r").length,h=a.moveStart("character",h);-1==a.compareEndPoints("StartToEnd",a);)h++,a.moveStart("character",1);else h=d.text.length;a=new y(g,h)}else b=(h||!a)&&c.previousSibling,a=(a=(h||a)&&c.nextSibling)&&C(a)?new y(a,0):b&&C(b)?new y(b,b.data.length):new y(m,x.getNodeIndex(c));c.parentNode.removeChild(c);
return{boundaryPosition:a,nodeInfo:{nodeIndex:f,containerElement:m}}},q=function(b,c){var a,h,f=b.offset,d=x.getDocument(b.node),m=v(d).createTextRange(),k=C(b.node);k?(a=b.node,h=a.parentNode):(a=b.node.childNodes,a=f<a.length?a[f]:null,h=b.node);d=d.createElement("span");d.innerHTML="&#feff;";a?h.insertBefore(d,a):h.appendChild(d);m.moveToElementText(d);m.collapse(!c);h.removeChild(d);if(k)m[c?"moveStart":"moveEnd"]("character",f);return m};t=function(b){this.textRange=b;this.refresh()};t.prototype=
new z(document);t.prototype.refresh=function(){var b,c,a;a=this.textRange;b=a.parentElement();var h=a.duplicate();h.collapse(!0);c=h.parentElement();h=a.duplicate();h.collapse(!1);a=h.parentElement();c=c==a?c:x.getCommonAncestor(c,a);c=c==b?c:x.getCommonAncestor(b,c);b=this.textRange;0==b.compareEndPoints("StartToEnd",b)?c=b=r(this.textRange,c,!0,!0).boundaryPosition:(a=r(this.textRange,c,!0,!1),b=a.boundaryPosition,c=r(this.textRange,c,!1,!1,a.nodeInfo).boundaryPosition);this.setStart(b.node,b.offset);
this.setEnd(c.node,c.offset)};t.prototype.getName=function(){return"WrappedTextRange"};z.copyComparisonConstants(t);t.rangeToTextRange=function(b){if(b.collapsed)return q(new y(b.startContainer,b.startOffset),!0);var c=q(new y(b.startContainer,b.startOffset),!0),a=q(new y(b.endContainer,b.endOffset),!1);b=v(z.getRangeDocument(b)).createTextRange();b.setEndPoint("StartToStart",c);b.setEndPoint("EndToEnd",a);return b};d.WrappedTextRange=t;if(!d.features.implementsDomRange||d.config.preferTextRange){var k=
function(){return this}();"undefined"==typeof k.Range&&(k.Range=t);d.createNativeRange=function(b){b=A(b,u,"createNativeRange");return v(b).createTextRange()};d.WrappedRange=t}}d.createRange=function(b){b=A(b,u,"createRange");return new d.WrappedRange(d.createNativeRange(b))};d.createRangyRange=function(b){b=A(b,u,"createRangyRange");return new z(b)};d.createIframeRange=function(b){u.deprecationNotice("createIframeRange()","createRange(iframeEl)");return d.createRange(b)};d.createIframeRangyRange=
function(b){u.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)");return d.createRangyRange(b)};d.addCreateMissingNativeApiListener(function(b){var c=b.document;"undefined"==typeof c.createRange&&(c.createRange=function(){return d.createRange(c)});c=b=null})});
rangy.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(d,u){function w(a){return"string"==typeof a?/^backward(s)?$/i.test(a):!!a}function t(a,e){if(a){if(E.isWindow(a))return a;if(a instanceof b)return a.win;var n=E.getContentDocument(a,u,e);return E.getWindow(n)}return window}function x(a){return t(a,"getWinSelection").getSelection()}function D(a){return t(a,"getDocSelection").document.selection}function y(a){var e=!1;a.anchorNode&&(e=1==E.comparePoints(a.anchorNode,a.anchorOffset,
a.focusNode,a.focusOffset));return e}function z(a,e,b){var l=b?"end":"start";b=b?"start":"end";a.anchorNode=e[l+"Container"];a.anchorOffset=e[l+"Offset"];a.focusNode=e[b+"Container"];a.focusOffset=e[b+"Offset"]}function v(a){a.anchorNode=a.focusNode=null;a.anchorOffset=a.focusOffset=0;a.rangeCount=0;a.isCollapsed=!0;a._ranges.length=0}function A(a){var e;a instanceof R?(e=d.createNativeRange(a.getDocument()),e.setEnd(a.endContainer,a.endOffset),e.setStart(a.startContainer,a.startOffset)):a instanceof
O?e=a.nativeRange:P.implementsDomRange&&a instanceof E.getWindow(a.startContainer).Range&&(e=a);return e}function C(a){var e=a.getNodes(),b;a:if(e.length&&1==e[0].nodeType){b=1;for(var l=e.length;b<l;++b)if(!E.isAncestorOf(e[0],e[b])){b=!1;break a}b=!0}else b=!1;if(!b)throw u.createError("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return e[0]}function r(a,e){var b=new O(e);a._ranges=[b];z(a,b,!1);a.rangeCount=1;a.isCollapsed=b.collapsed}function q(a){a._ranges.length=
0;if("None"==a.docSelection.type)v(a);else{var e=a.docSelection.createRange();if(e&&"undefined"!=typeof e.text)r(a,e);else{a.rangeCount=e.length;for(var b,l=Q(e.item(0)),c=0;c<a.rangeCount;++c)b=d.createRange(l),b.selectNode(e.item(c)),a._ranges.push(b);a.isCollapsed=1==a.rangeCount&&a._ranges[0].collapsed;z(a,a._ranges[a.rangeCount-1],!1)}}}function k(a,e){for(var b=a.docSelection.createRange(),l=C(e),c=Q(b.item(0)),c=W(c).createControlRange(),f=0,h=b.length;f<h;++f)c.add(b.item(f));try{c.add(l)}catch(d){throw u.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");
}c.select();q(a)}function b(a,e,b){this.nativeSelection=a;this.docSelection=e;this._ranges=[];this.win=b;this.refresh()}function c(a){a.win=a.anchorNode=a.focusNode=a._ranges=null;a.rangeCount=a.anchorOffset=a.focusOffset=0;a.detached=!0}function a(a,e){for(var b=ba.length,l,f;b--;)if(l=ba[b],f=l.selection,"deleteAll"==e)c(f);else if(l.win==a)return"delete"==e?(ba.splice(b,1),!0):f;"deleteAll"==e&&(ba.length=0);return null}function h(a,e){for(var b=Q(e[0].startContainer),b=W(b).createControlRange(),
l=0,c,f=e.length;l<f;++l){c=C(e[l]);try{b.add(c)}catch(h){throw u.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)");}}b.select();q(a)}function f(a,e){if(a.win.document!=Q(e))throw new B("WRONG_DOCUMENT_ERR");}function p(a){return function(e,b){var l;this.rangeCount?(l=this.getRangeAt(0),l["set"+(a?"Start":"End")](e,b)):(l=d.createRange(this.win.document),l.setStartAndEnd(e,b));this.setSingleRange(l,this.isBackward())}}
function m(a){var e=[],b=new H(a.anchorNode,a.anchorOffset),l=new H(a.focusNode,a.focusOffset),c="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var f=0,h=a.rangeCount;f<h;++f)e[f]=R.inspect(a.getRangeAt(f));return"["+c+"(Ranges: "+e.join(", ")+")(anchor: "+b.inspect()+", focus: "+l.inspect()+"]"}d.config.checkSelectionRanges=!0;var E=d.dom,g=d.util,I=g.isHostMethod,R=d.DomRange,O=d.WrappedRange,B=d.DOMException,H=E.DomPosition,N,V,P=d.features,Q=E.getDocument,
W=E.getBody,ca=R.rangesEqual,M=I(window,"getSelection"),S=g.isHostObject(document,"selection");P.implementsWinGetSelection=M;var F=(P.implementsDocSelection=S)&&(!M||d.config.preferTextRange);F?(N=D,d.isSelectionValid=function(a){a=t(a,"isSelectionValid").document;var e=a.selection;return"None"!=e.type||Q(e.createRange().parentElement())==a}):M?(N=x,d.isSelectionValid=function(){return!0}):u.fail("Neither document.selection or window.getSelection() detected.");d.getNativeSelection=N;var M=N(),X=d.createNativeRange(document),
l=W(document),J=g.areHostProperties(M,["anchorNode","focusNode","anchorOffset","focusOffset"]);P.selectionHasAnchorAndFocus=J;var K=I(M,"extend");P.selectionHasExtend=K;var $="number"==typeof M.rangeCount;P.selectionHasRangeCount=$;var Z=!1,ea=!0,L=K?function(a,e){var b=R.getRangeDocument(e),b=d.createRange(b);b.collapseToPoint(e.endContainer,e.endOffset);a.addRange(A(b));a.extend(e.startContainer,e.startOffset)}:null;g.areHostMethods(M,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof M.rangeCount&&
P.implementsDomRange&&function(){var a=window.getSelection();if(a){for(var e=a.rangeCount,b=1<e,l=[],c=y(a),f=0;f<e;++f)l[f]=a.getRangeAt(f);var f=W(document),h=f.appendChild(document.createElement("div"));h.contentEditable="false";var J=h.appendChild(document.createTextNode("\u00a0\u00a0\u00a0")),g=document.createRange();g.setStart(J,1);g.collapse(!0);a.addRange(g);ea=1==a.rangeCount;a.removeAllRanges();b||(b=g.cloneRange(),g.setStart(J,0),b.setEnd(J,3),b.setStart(J,2),a.addRange(g),a.addRange(b),
Z=2==a.rangeCount,b.detach());f.removeChild(h);a.removeAllRanges();g.detach();for(f=0;f<e;++f)0==f&&c?L?L(a,l[f]):(d.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because browser does not support Selection.extend"),a.addRange(l[f])):a.addRange(l[f])}}();P.selectionSupportsMultipleRanges=Z;P.collapsedNonEditableSelectionsSupported=ea;var T=!1;l&&I(l,"createControlRange")&&(l=l.createControlRange(),g.areHostProperties(l,["item","add"])&&(T=!0));
P.implementsControlRange=T;V=J?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var aa;I(M,"getRangeAt")?aa=function(a,e){try{return a.getRangeAt(e)}catch(b){return null}}:J&&(aa=function(a){var e=Q(a.anchorNode),e=d.createRange(e);e.setStartAndEnd(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset);e.collapsed!==this.isCollapsed&&e.setStartAndEnd(a.focusNode,a.focusOffset,a.anchorNode,a.anchorOffset);
return e});b.prototype=d.selectionPrototype;var ba=[],fa=function(l){if(l&&l instanceof b)return l.refresh(),l;l=t(l,"getNativeSelection");var e=a(l),n=N(l),c=S?D(l):null;e?(e.nativeSelection=n,e.docSelection=c,e.refresh()):(e=new b(n,c,l),ba.push({win:l,selection:e}));return e};d.getSelection=fa;d.getIframeSelection=function(a){u.deprecationNotice("getIframeSelection()","getSelection(iframeEl)");return d.getSelection(E.getIframeWindow(a))};l=b.prototype;if(!F&&J&&g.areHostMethods(M,["removeAllRanges",
"addRange"]))l.removeAllRanges=function(){this.nativeSelection.removeAllRanges();v(this)},l.addRange=$?function(a,e){if(T&&S&&"Control"==this.docSelection.type)k(this,a);else if(w(e)&&K)L(this.nativeSelection,a),this.refresh();else{var b;Z?b=this.rangeCount:(this.removeAllRanges(),b=0);this.nativeSelection.addRange(A(a).cloneRange());this.rangeCount=this.nativeSelection.rangeCount;this.rangeCount==b+1?(d.config.checkSelectionRanges&&(b=aa(this.nativeSelection,this.rangeCount-1))&&!ca(b,a)&&(a=new O(b)),
this._ranges[this.rangeCount-1]=a,z(this,a,da(this.nativeSelection)),this.isCollapsed=V(this)):this.refresh()}}:function(a,e){w(e)&&K?L(this.nativeSelection,a):this.nativeSelection.addRange(A(a));this.refresh()},l.setRanges=function(a){if(T&&1<a.length)h(this,a);else{this.removeAllRanges();for(var e=0,b=a.length;e<b;++e)this.addRange(a[e])}};else if(I(M,"empty")&&I(X,"select")&&T&&F)l.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var a;if(this.anchorNode)a=
Q(this.anchorNode);else if("Control"==this.docSelection.type){var e=this.docSelection.createRange();e.length&&(a=Q(e.item(0)))}a&&(W(a).createTextRange().select(),this.docSelection.empty())}}catch(b){}v(this)},l.addRange=function(a){"Control"==this.docSelection.type?k(this,a):(d.WrappedTextRange.rangeToTextRange(a).select(),this._ranges[0]=a,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,z(this,a,!1))},l.setRanges=function(a){this.removeAllRanges();var e=a.length;1<e?h(this,a):e&&this.addRange(a[0])};
else return u.fail("No means of selecting a Range or TextRange was found"),!1;l.getRangeAt=function(a){if(0>a||a>=this.rangeCount)throw new B("INDEX_SIZE_ERR");return this._ranges[a].cloneRange()};var U;if(F)U=function(a){var e;d.isSelectionValid(a.win)?e=a.docSelection.createRange():(e=W(a.win.document).createTextRange(),e.collapse(!0));"Control"==a.docSelection.type?q(a):e&&"undefined"!=typeof e.text?r(a,e):v(a)};else if(I(M,"getRangeAt")&&"number"==typeof M.rangeCount)U=function(a){if(T&&S&&"Control"==
a.docSelection.type)q(a);else if(a._ranges.length=a.rangeCount=a.nativeSelection.rangeCount,a.rangeCount){for(var e=0,b=a.rangeCount;e<b;++e)a._ranges[e]=new d.WrappedRange(a.nativeSelection.getRangeAt(e));z(a,a._ranges[a.rangeCount-1],da(a.nativeSelection));a.isCollapsed=V(a)}else v(a)};else if(J&&"boolean"==typeof M.isCollapsed&&"boolean"==typeof X.collapsed&&P.implementsDomRange)U=function(a){var e;e=a.nativeSelection;e.anchorNode?(e=aa(e,0),a._ranges=[e],a.rangeCount=1,e=a.nativeSelection,a.anchorNode=
e.anchorNode,a.anchorOffset=e.anchorOffset,a.focusNode=e.focusNode,a.focusOffset=e.focusOffset,a.isCollapsed=V(a)):v(a)};else return u.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;l.refresh=function(a){var e=a?this._ranges.slice(0):null,b=this.anchorNode,l=this.anchorOffset;U(this);if(a){a=e.length;if(a!=this._ranges.length||this.anchorNode!=b||this.anchorOffset!=l)return!0;for(;a--;)if(!ca(e[a],this._ranges[a]))return!0;return!1}};var Y=function(a,e){var b=
a.getAllRanges();a.removeAllRanges();for(var l=0,c=b.length;l<c;++l)ca(e,b[l])||a.addRange(b[l]);a.rangeCount||v(a)};l.removeRange=T?function(a){if("Control"==this.docSelection.type){var e=this.docSelection.createRange();a=C(a);for(var b=Q(e.item(0)),b=W(b).createControlRange(),l,c=!1,f=0,h=e.length;f<h;++f)l=e.item(f),l!==a||c?b.add(e.item(f)):c=!0;b.select();q(this)}else Y(this,a)}:function(a){Y(this,a)};var da;!F&&J&&P.implementsDomRange?(da=y,l.isBackward=function(){return da(this)}):da=l.isBackward=
function(){return!1};l.isBackwards=l.isBackward;l.toString=function(){for(var a=[],e=0,b=this.rangeCount;e<b;++e)a[e]=""+this._ranges[e];return a.join("")};l.collapse=function(a,e){f(this,a);var b=d.createRange(a);b.collapseToPoint(a,e);this.setSingleRange(b);this.isCollapsed=!0};l.collapseToStart=function(){if(this.rangeCount){var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)}else throw new B("INVALID_STATE_ERR");};l.collapseToEnd=function(){if(this.rangeCount){var a=this._ranges[this.rangeCount-
1];this.collapse(a.endContainer,a.endOffset)}else throw new B("INVALID_STATE_ERR");};l.selectAllChildren=function(a){f(this,a);var e=d.createRange(a);e.selectNodeContents(a);this.setSingleRange(e)};l.deleteFromDocument=function(){if(T&&S&&"Control"==this.docSelection.type){for(var a=this.docSelection.createRange(),e;a.length;)e=a.item(0),a.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount&&(a=this.getAllRanges(),a.length)){this.removeAllRanges();e=0;for(var b=a.length;e<
b;++e)a[e].deleteContents();this.addRange(a[b-1])}};l.eachRange=function(a,e){for(var b=0,l=this._ranges.length;b<l;++b)if(a(this.getRangeAt(b)))return e};l.getAllRanges=function(){var a=[];this.eachRange(function(e){a.push(e)});return a};l.setSingleRange=function(a,e){this.removeAllRanges();this.addRange(a,e)};l.callMethodOnEachRange=function(a,e){var b=[];this.eachRange(function(l){b.push(l[a].apply(l,e))});return b};l.setStart=p(!0);l.setEnd=p(!1);d.rangePrototype.select=function(a){fa(this.getDocument()).setSingleRange(this,
a)};l.changeEachRange=function(a){var e=[],b=this.isBackward();this.eachRange(function(b){a(b);e.push(b)});this.removeAllRanges();b&&1==e.length?this.addRange(e[0],"backward"):this.setRanges(e)};l.containsNode=function(a,e){return this.eachRange(function(b){return b.containsNode(a,e)},!0)};l.getBookmark=function(a){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[a])}};l.moveToBookmark=function(a){for(var e=[],b=0,l,c;l=a.rangeBookmarks[b++];)c=d.createRange(this.win),
c.moveToBookmark(l),e.push(c);a.backward?this.setSingleRange(e[0],"backward"):this.setRanges(e)};l.toHtml=function(){return this.callMethodOnEachRange("toHtml").join("")};l.getName=function(){return"WrappedSelection"};l.inspect=function(){return m(this)};l.detach=function(){a(this.win,"delete");c(this)};b.detachAll=function(){a(null,"deleteAll")};b.inspect=m;b.isDirectionBackward=w;d.Selection=b;d.selectionPrototype=l;d.addCreateMissingNativeApiListener(function(a){"undefined"==typeof a.getSelection&&
(a.getSelection=function(){return fa(a)});a=null})});rangy.createModule("ClassApplier",["WrappedSelection"],function(d,u){function w(a,b){for(var c in a)if(a.hasOwnProperty(c)&&!1===b(c,a[c]))return!1;return!0}function t(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function x(a,b){return a.className&&(new RegExp("(?:^|\\s)"+b+"(?:\\s|$)")).test(a.className)}function D(a,b){a.className?x(a,b)||(a.className+=" "+b):a.className=b}function y(a){return a.split(/\s+/).sort().join(" ")}function z(a,b){return y(a.className)==y(b.className)}function v(a,
b,c,f){-1==c&&(c=b.childNodes.length);for(var h=a.parentNode,d=B.getNodeIndex(a),g=0,p;p=f[g++];){var m=p.node,k=p.offset,r=m,q=k;m==b&&k>c&&++q;m!=h||k!=d&&k!=d+1||(r=b,q+=c-d);m==h&&k>d+1&&--q;p.node=r;p.offset=q}b.childNodes.length==c?b.appendChild(a):b.insertBefore(a,b.childNodes[c])}function A(a,b){for(var c=a.parentNode,f=B.getNodeIndex(a),h=0,d;d=b[h++];)d.node==c&&d.offset>f&&--d.offset;a.parentNode.removeChild(a)}function C(a,b){for(var c=a.parentNode,f=B.getNodeIndex(a),h,d=[];h=a.firstChild;)v(h,
c,f++,b),d.push(h);a.parentNode.removeChild(a);return d}function r(a,b){var c=a.cloneRange();c.selectNodeContents(b);var f=c.intersection(a),f=f?f.toString():"";c.detach();return""!=f}function q(a){for(var b=a.getNodes([3]),c=0,f;(f=b[c])&&!r(a,f);)++c;for(var h=b.length-1;(f=b[h])&&!r(a,f);)--h;return b.slice(c,h+1)}function k(a,b){if(a.attributes.length!=b.attributes.length)return!1;for(var c=0,f=a.attributes.length,h,d;c<f;++c)if(h=a.attributes[c],d=h.name,"class"!=d&&(d=b.attributes.getNamedItem(d),
null===h!=(null===d)||h.specified!=d.specified||h.specified&&h.nodeValue!==d.nodeValue))return!1;return!0}function b(a,b){for(var c=0,f=a.attributes.length,h;c<f;++c)if(h=a.attributes[c].name,(!b||!N(b,h))&&a.attributes[c].specified&&"class"!=h)return!0;return!1}function c(a,b){w(b,function(b,f){if("object"==typeof f){if(!c(a[b],f))return!1}else if(a[b]!==f)return!1});return!0}function a(a){var b;return a&&1==a.nodeType&&((b=a.parentNode)&&9==b.nodeType&&"on"==b.designMode||Q(a)&&!Q(a.parentNode))}
function h(b){return(Q(b)||1!=b.nodeType&&Q(b.parentNode))&&!a(b)}function f(a){return a&&1==a.nodeType&&!W.test(P(a,"display"))}function p(a){if(0==a.data.length)return!0;if(ca.test(a.data))return!1;switch(P(a.parentNode,"whiteSpace")){case "pre":case "pre-wrap":case "-moz-pre-wrap":return!1;case "pre-line":if(/[\r\n]/.test(a.data))return!1}return f(a.previousSibling)||f(a.nextSibling)}function m(a){var b=[],c,f;for(c=0;f=a[c++];)b.push(new H(f.startContainer,f.startOffset),new H(f.endContainer,
f.endOffset));return b}function E(a,b){for(var c=0,f,h,d,g=a.length;c<g;++c)f=a[c],h=b[2*c],d=b[2*c+1],f.setStartAndEnd(h.node,h.offset,d.node,d.offset)}function g(a,b,c,f){var h,d;d=0==c;if(B.isAncestorOf(b,a))return a;if(B.isCharacterDataNode(b)){h=B.getNodeIndex(b);if(0==c)c=h;else if(c==b.length)c=h+1;else throw u.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+c+" in "+b.data);b=b.parentNode}h=b;var p=c;if(B.isCharacterDataNode(h)?0==p?h.previousSibling:
p==h.length?h.nextSibling:1:0<p&&p<h.childNodes.length){h=b.cloneNode(!1);d=b.parentNode;h.id&&h.removeAttribute("id");for(var k=0;p=b.childNodes[c];)v(p,h,k++,f);v(h,d,B.getNodeIndex(b)+1,f);return b==a?h:g(a,d,B.getNodeIndex(h),f)}return a!=b?(h=b.parentNode,b=B.getNodeIndex(b),d||b++,g(a,h,b,f)):a}function I(a){var b=a?"nextSibling":"previousSibling";return function(c,f){var h=c.parentNode,d=c[b];if(d){if(d&&3==d.nodeType)return d}else if(f){var d=h[b],g;if(g=d&&1==d.nodeType)g=d,g=h.tagName==
g.tagName&&z(h,g)&&k(h,g)&&"inline"==P(h,"display")&&"inline"==P(g,"display");if(g&&(h=d[a?"firstChild":"lastChild"])&&3==h.nodeType)return h}return null}}function R(a){this.isElementMerge=1==a.nodeType;this.textNodes=[];(a=this.isElementMerge?a.lastChild:a)&&(this.textNodes[0]=a)}function O(a,b,c){var f,h,d=this;d.cssClass=a;var g=null,p={};if("object"==typeof b&&null!==b){c=b.tagNames;g=b.elementProperties;p=b.elementAttributes;for(f=0;h=F[f++];)b.hasOwnProperty(h)&&(d[h]=b[h]);f=b.normalize}else f=
b;d.normalize="undefined"==typeof f?!0:f;d.attrExceptions=[];f=document.createElement(d.elementTagName);d.elementProperties=d.copyPropertiesToElement(g,f,!0);w(p,function(a){d.attrExceptions.push(a)});d.elementAttributes=p;d.elementSortedClassName=d.elementProperties.hasOwnProperty("className")?d.elementProperties.className:a;d.applyToAnyTagName=!1;a=typeof c;if("string"==a)"*"==c?d.applyToAnyTagName=!0:d.tagNames=t(c.toLowerCase()).split(/\s*,\s*/);else if("object"==a&&"number"==typeof c.length)for(d.tagNames=
[],f=0,a=c.length;f<a;++f)"*"==c[f]?d.applyToAnyTagName=!0:d.tagNames.push(c[f].toLowerCase());else d.tagNames=[d.elementTagName]}var B=d.dom,H=B.DomPosition,N=B.arrayContains,V=function(){function a(b,c,f){return c&&f?" ":""}return function(b,c){b.className&&(b.className=b.className.replace(new RegExp("(^|\\s)"+c+"(\\s|$)"),a))}}(),P=B.getComputedStyleProperty,Q=function(){return"boolean"==typeof document.createElement("div").isContentEditable?function(a){return a&&1==a.nodeType&&a.isContentEditable}:
function(a){return a&&1==a.nodeType&&"false"!=a.contentEditable?"true"==a.contentEditable||Q(a.parentNode):!1}}(),W=/^inline(-block|-table)?$/i,ca=/[^\r\n\t\f \u200B]/,M=I(!1),S=I(!0);R.prototype={doMerge:function(a){var b=this.textNodes,c=b[0];if(1<b.length){for(var f=[],h=0,d,g,p=0,k=b.length,m;p<k;++p){d=b[p];g=d.parentNode;if(0<p&&(g.removeChild(d),g.hasChildNodes()||g.parentNode.removeChild(g),a))for(g=0;m=a[g++];)m.node==d&&(m.node=c,m.offset+=h);f[p]=d.data;h+=d.data.length}c.data=f.join("")}return c.data},
getLength:function(){for(var a=this.textNodes.length,b=0;a--;)b+=this.textNodes[a].length;return b},toString:function(){for(var a=[],b=0,c=this.textNodes.length;b<c;++b)a[b]="'"+this.textNodes[b].data+"'";return"[Merge("+a.join(",")+")]"}};var F="elementTagName ignoreWhiteSpace applyToEditableOnly useExistingElements removeEmptyElements onElementCreate".split(" "),X={};O.prototype={elementTagName:"span",elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,
removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(a,b,c){var f,h,d={},g,p,m;for(m in a)if(a.hasOwnProperty(m))if(p=a[m],h=b[m],"className"==m)D(b,p),D(b,this.cssClass),b[m]=y(b[m]),c&&(d[m]=b[m]);else if("style"==m){c&&(d[m]=g={});for(f in a[m])h[f]=p[f],c&&(g[f]=h[f]);this.attrExceptions.push(m)}else b[m]=p,c&&(d[m]=b[m],p=X.hasOwnProperty(m)?X[m]:m,this.attrExceptions.push(p));return c?d:""},copyAttributesToElement:function(a,b){for(var c in a)a.hasOwnProperty(c)&&b.setAttribute(c,
a[c])},hasClass:function(a){return 1==a.nodeType&&N(this.tagNames,a.tagName.toLowerCase())&&x(a,this.cssClass)},getSelfOrAncestorWithClass:function(a){for(;a;){if(this.hasClass(a))return a;a=a.parentNode}return null},isModifiable:function(a){return!this.applyToEditableOnly||h(a)},isIgnorableWhiteSpaceNode:function(a){return this.ignoreWhiteSpace&&a&&3==a.nodeType&&p(a)},postApply:function(a,b,c,f){for(var h=a[0],d=a[a.length-1],g=[],p,m=h,k=d,r=0,q=d.length,E,t,s=0,e=a.length;s<e;++s)E=a[s],(t=M(E,
!f))?(p||(p=new R(t),g.push(p)),p.textNodes.push(E),E===h&&(m=p.textNodes[0],r=m.length),E===d&&(k=p.textNodes[0],q=p.getLength())):p=null;if(a=S(d,!f))p||(p=new R(d),g.push(p)),p.textNodes.push(a);if(g.length){s=0;for(e=g.length;s<e;++s)g[s].doMerge(c);b.setStartAndEnd(m,r,k,q)}},createContainer:function(a){a=a.createElement(this.elementTagName);this.copyPropertiesToElement(this.elementProperties,a,!1);this.copyAttributesToElement(this.elementAttributes,a);D(a,this.cssClass);if(this.onElementCreate)this.onElementCreate(a,
this);return a},applyToTextNode:function(a,b){var f=a.parentNode;1==f.childNodes.length&&this.useExistingElements&&N(this.tagNames,f.tagName.toLowerCase())&&c(f,this.elementProperties)?D(f,this.cssClass):(f=this.createContainer(B.getDocument(a)),a.parentNode.insertBefore(f,a),f.appendChild(a))},isRemovable:function(a){return a.tagName.toLowerCase()==this.elementTagName&&y(a.className)==this.elementSortedClassName&&c(a,this.elementProperties)&&!b(a,this.attrExceptions)&&this.isModifiable(a)},isEmptyContainer:function(a){var b=
a.childNodes.length;return 1==a.nodeType&&this.isRemovable(a)&&(0==b||1==b&&this.isEmptyContainer(a.firstChild))},removeEmptyContainers:function(a){var b=this,c=a.getNodes([1],function(a){return b.isEmptyContainer(a)});a=[a];for(var f=m(a),h=0,d;d=c[h++];)A(d,f);E(a,f)},undoToTextNode:function(a,b,c,f){b.containsNode(c)||(a=b.cloneRange(),a.selectNode(c),a.isPointInRange(b.endContainer,b.endOffset)&&(g(c,b.endContainer,b.endOffset,f),b.setEndAfter(c)),a.isPointInRange(b.startContainer,b.startOffset)&&
(c=g(c,b.startContainer,b.startOffset,f)));this.isRemovable(c)?C(c,f):V(c,this.cssClass)},applyToRange:function(a,b){b=b||[];var c=m(b||[]);a.splitBoundariesPreservingPositions(c);this.removeEmptyElements&&this.removeEmptyContainers(a);var f=q(a);if(f.length){for(var h=0,d;d=f[h++];)this.isIgnorableWhiteSpaceNode(d)||this.getSelfOrAncestorWithClass(d)||!this.isModifiable(d)||this.applyToTextNode(d,c);d=f[f.length-1];a.setStartAndEnd(f[0],0,d,d.length);this.normalize&&this.postApply(f,a,c,!1);E(b,
c)}},applyToRanges:function(a){for(var b=a.length;b--;)this.applyToRange(a[b],a);return a},applyToSelection:function(a){a=d.getSelection(a);a.setRanges(this.applyToRanges(a.getAllRanges()))},undoToRange:function(a,b){b=b||[];var c=m(b);a.splitBoundariesPreservingPositions(c);this.removeEmptyElements&&this.removeEmptyContainers(a,c);var f=q(a),d,h,g=f[f.length-1];if(f.length){for(var p=0,k=f.length;p<k;++p)d=f[p],(h=this.getSelfOrAncestorWithClass(d))&&this.isModifiable(d)&&this.undoToTextNode(d,a,
h,c),a.setStartAndEnd(f[0],0,g,g.length);this.normalize&&this.postApply(f,a,c,!0);E(b,c)}},undoToRanges:function(a){for(var b=a.length;b--;)this.undoToRange(a[b],a);return a},undoToSelection:function(a){var b=d.getSelection(a);a=d.getSelection(a).getAllRanges();this.undoToRanges(a);b.setRanges(a)},isAppliedToRange:function(a){if(a.collapsed||""==a.toString())return!!this.getSelfOrAncestorWithClass(a.commonAncestorContainer);var b=a.getNodes([3]);if(b.length)for(var c=0,f;f=b[c++];)if(!this.isIgnorableWhiteSpaceNode(f)&&
r(a,f)&&this.isModifiable(f)&&!this.getSelfOrAncestorWithClass(f))return!1;return!0},isAppliedToRanges:function(a){var b=a.length;if(0==b)return!1;for(;b--;)if(!this.isAppliedToRange(a[b]))return!1;return!0},isAppliedToSelection:function(a){a=d.getSelection(a);return this.isAppliedToRanges(a.getAllRanges())},toggleRange:function(a){this.isAppliedToRange(a)?this.undoToRange(a):this.applyToRange(a)},toggleSelection:function(a){this.isAppliedToSelection(a)?this.undoToSelection(a):this.applyToSelection(a)},
getElementsWithClassIntersectingRange:function(a){var b=[],c=this;a.getNodes([3],function(a){(a=c.getSelfOrAncestorWithClass(a))&&!N(b,a)&&b.push(a)});return b},detach:function(){}};O.util={hasClass:x,addClass:D,removeClass:V,hasSameClasses:z,replaceWithOwnChildren:C,elementsHaveSameNonClassAttributes:k,elementHasNonClassAttributes:b,splitNodeAt:g,isEditableElement:Q,isEditingHost:a,isEditable:h};d.CssClassApplier=d.ClassApplier=O;d.createCssClassApplier=d.createClassApplier=function(a,b,c){return new O(a,
b,c)}});rangy.createModule("Highlighter",["ClassApplier"],function(d,u){function w(a,b){return a.characterRange.start-b.characterRange.start}function t(a,b){this.type=a;this.converterCreator=b}function x(a,c){b[a]=new t(a,c)}function D(a){var c=b[a];if(c instanceof t)return c.create();throw Error("Highlighter type '"+a+"' is not valid");}function y(a,b){this.start=a;this.end=b}function z(a,b,c,d,m,r){m?(this.id=m,k=Math.max(k,m+1)):this.id=k++;this.characterRange=b;this.doc=a;this.classApplier=c;this.converter=
d;this.containerElementId=r||null;this.applied=!1}function v(a,b){this.doc=a||document;this.classAppliers={};this.highlights=[];this.converter=D(b||"textContent")}var A=d.dom,C=A.arrayContains,r=A.getBody,q=[].forEach?function(a,b){a.forEach(b)}:function(a,b){for(var c=0,d=a.length;c<d;++c)b(a[c])},k=1,b={};t.prototype.create=function(){var a=this.converterCreator();a.type=this.type;return a};d.registerHighlighterType=x;y.prototype={intersects:function(a){return this.start<a.end&&this.end>a.start},
union:function(a){return new y(Math.min(this.start,a.start),Math.max(this.end,a.end))},intersection:function(a){return new y(Math.max(this.start,a.start),Math.min(this.end,a.end))},toString:function(){return"[CharacterRange("+this.start+", "+this.end+")]"}};y.fromCharacterRange=function(a){return new y(a.start,a.end)};var c={rangeToCharacterRange:function(a,b){var c=a.getBookmark(b);return new y(c.start,c.end)},characterRangeToRange:function(a,b,c){a=d.createRange(a);a.moveToBookmark({start:b.start,
end:b.end,containerNode:c});return a},serializeSelection:function(a,b){for(var c=a.getAllRanges(),d=[],m=1==c.length&&a.isBackward(),k=0,g=c.length;k<g;++k)d[k]={characterRange:this.rangeToCharacterRange(c[k],b),backward:m};return d},restoreSelection:function(a,b,c){a.removeAllRanges();for(var d=a.win.document,m=0,k=b.length,g,r;m<k;++m)r=b[m],g=this.characterRangeToRange(d,r.characterRange,c),a.addRange(g,r.backward)}};x("textContent",function(){return c});x("TextRange",function(){var a;return function(){if(!a){var b=
d.modules.TextRange;if(!b)throw Error("TextRange module is missing.");if(!b.supported)throw Error("TextRange module is present but not supported.");a={rangeToCharacterRange:function(a,b){return y.fromCharacterRange(a.toCharacterRange(b))},characterRangeToRange:function(a,b,c){a=d.createRange(a);a.selectCharacters(c,b.start,b.end);return a},serializeSelection:function(a,b){return a.saveCharacterRanges(b)},restoreSelection:function(a,b,c){a.restoreCharacterRanges(c,b)}}}return a}}());z.prototype={getContainerElement:function(){return this.containerElementId?
this.doc.getElementById(this.containerElementId):r(this.doc)},getRange:function(){return this.converter.characterRangeToRange(this.doc,this.characterRange,this.getContainerElement())},fromRange:function(a){this.characterRange=this.converter.rangeToCharacterRange(a,this.getContainerElement())},getText:function(){return this.getRange().toString()},containsElement:function(a){return this.getRange().containsNodeContents(a.firstChild)},unapply:function(){this.classApplier.undoToRange(this.getRange());
this.applied=!1},apply:function(){this.classApplier.applyToRange(this.getRange());this.applied=!0},getHighlightElements:function(){return this.classApplier.getElementsWithClassIntersectingRange(this.getRange())},toString:function(){return"[Highlight(ID: "+this.id+", class: "+this.classApplier.cssClass+", character range: "+this.characterRange.start+" - "+this.characterRange.end+")]"}};v.prototype={addClassApplier:function(a){this.classAppliers[a.cssClass]=a},getHighlightForElement:function(a){for(var b=
this.highlights,c=0,d=b.length;c<d;++c)if(b[c].containsElement(a))return b[c];return null},removeHighlights:function(a){for(var b=0,c=this.highlights.length,d;b<c;++b)d=this.highlights[b],C(a,d)&&(d.unapply(),this.highlights.splice(b--,1))},removeAllHighlights:function(){this.removeHighlights(this.highlights)},getIntersectingHighlights:function(a){var b=[],c=this.highlights;q(a,function(a){q(c,function(c){a.intersectsRange(c.getRange())&&!C(b,c)&&b.push(c)})});return b},highlightCharacterRanges:function(a,
b,c){var p,m,k,g=this.highlights,r=this.converter,t=this.doc,u=[];a=this.classAppliers[a];c=c||null;var w;c&&(p=this.doc.getElementById(c))&&(m=d.createRange(this.doc),m.selectNodeContents(p),w=new y(0,m.toString().length),m.detach());var v,x;p=0;for(m=b.length;p<m;++p){v=b[p];w&&(v=v.intersection(w));for(k=0;k<g.length;++k)c==g[k].containerElementId&&(x=g[k].characterRange,x.intersects(v)&&(u.push(g[k]),g[k]=new z(t,x.union(v),a,r,null,c)));g.push(new z(t,v,a,r,null,c))}q(u,function(a){a.unapply()});
var A=[];q(g,function(a){a.applied||(a.apply(),A.push(a))});return A},highlightRanges:function(a,b,c){var p=[],k=this.converter;a=c?c.id:null;var t;c&&(t=d.createRange(c),t.selectNodeContents(c));q(b,function(a){var b=c?t.intersection(a):a;p.push(k.rangeToCharacterRange(b,c||r(a.getDocument())))});return this.highlightCharacterRanges(p,b,a)},highlightSelection:function(a,b,c){var p=this.converter;b=b||d.getSelection();var k=this.classAppliers[a],t=b.win.document,t=c?t.getElementById(c):r(t);if(!k)throw Error("No class applier found for class '"+
a+"'");var k=p.serializeSelection(b,t),g=[];q(k,function(a){g.push(y.fromCharacterRange(a.characterRange))});a=this.highlightCharacterRanges(a,g,c);p.restoreSelection(b,k,t);return a},unhighlightSelection:function(a){a=a||d.getSelection();var b=this.getIntersectingHighlights(a.getAllRanges());this.removeHighlights(b);a.removeAllRanges();return b},getHighlightsInSelection:function(a){a=a||d.getSelection();return this.getIntersectingHighlights(a.getAllRanges())},selectionOverlapsHighlight:function(a){return 0<
this.getHighlightsInSelection(a).length},serialize:function(a){var b=this.highlights;b.sort(w);var c=["type:"+this.converter.type];q(b,function(b){var d=b.characterRange,d=[d.start,d.end,b.id,b.classApplier.cssClass,b.containerElementId];a&&a.serializeHighlightText&&d.push(b.getText());c.push(d.join("$"))});return c.join("|")},deserialize:function(a){a=a.split("|");var b=[],c=a[0],d,k,q=!1;if(c&&(d=/^type:(\w+)$/.exec(c)))d=d[1],d!=this.converter.type&&(k=D(d),q=!0),a.shift();else throw Error("Serialized highlights are invalid.");
var g,t;d=a.length;for(var u;0<d--;)u=a[d].split("$"),c=new y(+u[0],+u[1]),g=(t=u[4]||null)?this.doc.getElementById(t):r(this.doc),q&&(c=this.converter.rangeToCharacterRange(k.characterRangeToRange(this.doc,c,g),g)),g=this.classAppliers[u[3]],c=new z(this.doc,c,g,this.converter,parseInt(u[2]),t),c.apply(),b.push(c);this.highlights=b}};d.Highlighter=v;d.createHighlighter=function(a,b){return new v(a,b)}});rangy.createModule("SaveRestore",["WrappedRange"],function(d,u){function w(d,q){var k="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),b,c=C.getDocument(d.startContainer),a=d.cloneRange();a.collapse(q);b=c.createElement("span");b.id=k;b.style.lineHeight="0";b.style.display="none";b.className="rangySelectionBoundary";b.appendChild(c.createTextNode("\ufeff"));a.insertNode(b);a.detach();return b}function t(d,q,k,b){(d=(d||document).getElementById(k))?(q[b?"setStartBefore":"setEndBefore"](d),
d.parentNode.removeChild(d)):u.warn("Marker element has been removed. Cannot restore selection.")}function x(d,q){return q.compareBoundaryPoints(d.START_TO_START,d)}function D(r,q){var k,b,c=d.DomRange.getRangeDocument(r),a=r.toString();if(r.collapsed)return b=w(r,!1),{document:c,markerId:b.id,collapsed:!0};b=w(r,!1);k=w(r,!0);return{document:c,startMarkerId:k.id,endMarkerId:b.id,collapsed:!1,backward:q,toString:function(){return"original text: '"+a+"', new text: '"+r.toString()+"'"}}}function y(r,
q){var k=r.document;"undefined"==typeof q&&(q=!0);var b=d.createRange(k);if(r.collapsed)if(k=(k||document).getElementById(r.markerId)){k.style.display="inline";var c=k.previousSibling;c&&3==c.nodeType?(k.parentNode.removeChild(k),b.collapseToPoint(c,c.length)):(b.collapseBefore(k),k.parentNode.removeChild(k))}else u.warn("Marker element has been removed. Cannot restore selection.");else t(k,b,r.startMarkerId,!0),t(k,b,r.endMarkerId,!1);q&&b.normalizeBoundaries();return b}function z(r,q){var k=[],
b,c;r=r.slice(0);r.sort(x);var a=0;for(b=r.length;a<b;++a)k[a]=D(r[a],q);for(a=b-1;0<=a;--a)b=r[a],c=d.DomRange.getRangeDocument(b),b.collapsed?b.collapseAfter((c||document).getElementById(k[a].markerId)):(b.setEndBefore((c||document).getElementById(k[a].endMarkerId)),b.setStartAfter((c||document).getElementById(k[a].startMarkerId)));return k}function v(d){for(var q=[],k=d.length-1;0<=k;k--)q[k]=y(d[k],!0);return q}function A(d,q){var k=(d||document).getElementById(q);k&&k.parentNode.removeChild(k)}
var C=d.dom;d.util.extend(d,{saveRange:D,restoreRange:y,saveRanges:z,restoreRanges:v,saveSelection:function(r){if(!d.isSelectionValid(r))return u.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var q=d.getSelection(r),k=q.getAllRanges(),b=1==k.length&&q.isBackward(),c=z(k,b);b?q.setSingleRange(k[0],"backward"):q.setRanges(k);return{win:r,rangeInfos:c,restored:!1}},restoreSelection:function(r,q){if(!r.restored){var k=
r.rangeInfos,b=d.getSelection(r.win),c=v(k);1==k.length&&q&&d.features.selectionHasExtend&&k[0].backward?(b.removeAllRanges(),b.addRange(c[0],!0)):b.setRanges(c);r.restored=!0}},removeMarkerElement:A,removeMarkers:function(d){for(var q=d.rangeInfos,k=0,b=q.length,c;k<b;++k)c=q[k],c.collapsed?A(d.doc,c.markerId):(A(d.doc,c.startMarkerId),A(d.doc,c.endMarkerId))}})});rangy.createModule("Serializer",["WrappedSelection"],function(d,u){function w(b,c){c=c||[];var a=b.nodeType,d=b.childNodes,f=d.length,k=[a,b.nodeName,f].join(":"),m="",q="";switch(a){case 3:m=b.nodeValue.replace(/</g,"&lt;").replace(/>/g,"&gt;");break;case 8:m="\x3c!--"+b.nodeValue.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"--\x3e";break;default:m="<"+k+">",q="</>"}m&&c.push(m);for(a=0;a<f;++a)w(d[a],c);q&&c.push(q);return c}function t(b){b=w(b).join("");return r(b).toString(16)}function x(b,c,a){var d=
[],f=b;for(a=a||q.getDocument(b).documentElement;f&&f!=a;)d.push(q.getNodeIndex(f,!0)),f=f.parentNode;return d.join("/")+":"+c}function D(b,c,a){c||(c=(a||document).documentElement);b=b.split(":");a=b[0]?b[0].split("/"):[];for(var d=a.length,f;d--;)if(f=parseInt(a[d],10),f<c.childNodes.length)c=c.childNodes[f];else throw u.createError("deserializePosition() failed: node "+q.inspectNode(c)+" has no child with index "+f+", "+d);return new q.DomPosition(c,parseInt(b[1],10))}function y(b,c,a){a=a||d.DomRange.getRangeDocument(b).documentElement;
if(!q.isOrIsAncestorOf(a,b.commonAncestorContainer))throw u.createError("serializeRange(): range "+b.inspect()+" is not wholly contained within specified root node "+q.inspectNode(a));b=x(b.startContainer,b.startOffset,a)+","+x(b.endContainer,b.endOffset,a);c||(b+="{"+t(a)+"}");return b}function z(b,c,a){c?a=a||q.getDocument(c):(a=a||document,c=a.documentElement);b=k.exec(b);var h=b[4],f=t(c);if(h&&h!==t(c))throw u.createError("deserializeRange(): checksums of serialized range root node ("+h+") and target root node ("+
f+") do not match");h=D(b[1],c,a);c=D(b[2],c,a);a=d.createRange(a);a.setStartAndEnd(h.node,h.offset,c.node,c.offset);return a}function v(b,c,a){c||(c=(a||document).documentElement);b=k.exec(b)[3];return!b||b===t(c)}function A(b,c,a){b=d.getSelection(b);b=b.getAllRanges();for(var h=[],f=0,k=b.length;f<k;++f)h[f]=y(b[f],c,a);return h.join("|")}function C(b,c,a){c?a=a||q.getWindow(c):(a=a||window,c=a.document.documentElement);b=b.split("|");for(var h=d.getSelection(a),f=[],k=0,m=b.length;k<m;++k)f[k]=
z(b[k],c,a.document);h.setRanges(f);return h}"undefined"!=typeof encodeURIComponent&&"undefined"!=typeof decodeURIComponent||u.fail("Global object is missing encodeURIComponent and/or decodeURIComponent method");var r=function(){var b=null;return function(c){for(var a=[],d=0,f=c.length,k;d<f;++d)k=c.charCodeAt(d),128>k?a.push(k):2048>k?a.push(k>>6|192,k&63|128):a.push(k>>12|224,k>>6&63|128,k&63|128);c=-1;if(!b){for(var d=[],f=0,m;256>f;++f){m=f;for(k=8;k--;)m=1==(m&1)?m>>>1^3988292384:m>>>1;d[f]=
m>>>0}b=d}d=b;f=0;for(k=a.length;f<k;++f)m=(c^a[f])&255,c=c>>>8^d[m];return(c^-1)>>>0}}(),q=d.dom,k=/^([^,]+),([^,\{]+)(\{([^}]+)\})?$/;d.serializePosition=x;d.deserializePosition=D;d.serializeRange=y;d.deserializeRange=z;d.canDeserializeRange=v;d.serializeSelection=A;d.deserializeSelection=C;d.canDeserializeSelection=function(b,c,a){var d;c?d=a?a.document:q.getDocument(c):(a=a||window,c=a.document.documentElement);b=b.split("|");a=0;for(var f=b.length;a<f;++a)if(!v(b[a],c,d))return!1;return!0};d.restoreSelectionFromCookie=
function(b){b=b||window;var c;a:{c=b.document.cookie.split(/[;,]/);for(var a=0,d=c.length,f;a<d;++a)if(f=c[a].split("="),"rangySerializedSelection"==f[0].replace(/^\s+/,"")&&(f=f[1])){c=decodeURIComponent(f.replace(/\s+$/,""));break a}c=null}c&&C(c,b.doc)};d.saveSelectionCookie=function(b,c){b=b||window;c="object"==typeof c?c:{};var a=c.expires?";expires="+c.expires.toUTCString():"",h=c.path?";path="+c.path:"",f=c.domain?";domain="+c.domain:"",k=c.secure?";secure":"",m=A(d.getSelection(b));b.document.cookie=
encodeURIComponent("rangySerializedSelection")+"="+encodeURIComponent(m)+a+h+f+k};d.getElementChecksum=t;d.nodeToInfoString=w});rangy.createModule("TextRange",["WrappedSelection"],function(d,u){function w(a,b){if(a){var c={};N(c,b);N(c,a);return c}return b}function t(a){var b,c;return a?(b=a.language||"en",c={},N(c,J[b]||J.en),N(c,a),c):J.en}function x(a,b){var c=L(a,"display",b),d=a.tagName.toLowerCase();return"block"==c&&T&&aa.hasOwnProperty(d)?aa[d]:c}function D(a){for(var b=a,c=[];b.parentNode;)c.unshift(b.parentNode),b=b.parentNode;a=c.concat([a]);b=0;for(c=a.length;b<c;++b)if(1==a[b].nodeType&&"none"==x(a[b]))return!0;
return!1}function y(a,b){if(!b&&a.hasChildNodes())return a.firstChild;var c;for(c=a;c&&!c.nextSibling;)c=c.parentNode;c=c?c.nextSibling:null;return c}function z(a){var b=a.previousSibling;if(b){for(a=b;a.hasChildNodes();)a=a.lastChild;return a}return(a=a.parentNode)&&1==a.nodeType?a:null}function v(a){if(!a||3!=a.nodeType)return!1;var b=a.data;if(""===b)return!0;var c=a.parentNode;if(!c||1!=c.nodeType)return!1;a=L(a.parentNode,"whiteSpace");return/^[\t\n\r ]+$/.test(b)&&/^(normal|nowrap)$/.test(a)||
/^[\t\r ]+$/.test(b)&&"pre-line"==a}function A(a){return""===a.data?!0:v(a)?!a.parentNode||D(a)?!0:!1:!1}function C(a){var b=a.nodeType;if(!(b=7==b||8==b||D(a)||/^(script|style)$/i.test(a.nodeName)))var c,b=3==a.nodeType&&(c=a.parentNode)&&"hidden"==L(c,"visibility");return b||A(a)}function r(a,b){var c=a.nodeType;return 7==c||8==c||1==c&&"none"==x(a,b)}function q(){this.store={}}function k(a,b,c){return function(d){var f=this.cache;if(f.hasOwnProperty(a))return ba++,f[a];fa++;d=b.call(this,c?this[c]:
this,d);return f[a]=d}}function b(a,b){this.node=a;this.session=b;this.cache=new q;this.positions=new q}function c(a,b){this.offset=b;this.nodeWrapper=a;this.node=a.node;this.session=a.session;this.cache=new q}function a(){h();return Y=new da}function h(){Y&&Y.detach();Y=null}function f(a,b,c,d){function f(){var a=null;b?(a=g,h||(g=g.previousVisible(),h=!g||c&&g.equals(c))):h||(a=g=g.nextVisible(),h=!g||c&&g.equals(c));h&&(g=null);return a}c&&(b?C(c.node)&&(c=a.previousVisible()):C(c.node)&&(c=c.nextVisible()));
var g=a,h=!1,k,l=!1;return{next:function(){if(l)return l=!1,k;for(var a,b;a=f();)if(b=a.getCharacter(d))return k=a;return null},rewind:function(){if(k)l=!0;else throw u.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.");},dispose:function(){a=c=null}}}function p(a,b,c){function d(a){for(var b,e=[],c=a?g:h,f=!1,n=!1;a=c.next();){b=a.character;if(W.test(b))n&&(n=!1,f=!0);else if(f){c.rewind();break}else n=!0;e.push(a)}return e}var g=f(a,!1,null,b),h=f(a,!0,null,
b),k=c.tokenizer;a=d(!0);b=d(!1).reverse();var l=k(b.concat(a),c),m=a.length?l.slice(s(l,a[0].token)):[],p=b.length?l.slice(0,s(l,b.pop().token)+1):[];return{nextEndToken:function(){for(var a,b;1==m.length&&!(a=m[0]).isWord&&0<(b=d(!0)).length;)m=k(a.chars.concat(b),c);return m.shift()},previousStartToken:function(){for(var a,b;1==p.length&&!(a=p[0]).isWord&&0<(b=d(!1)).length;)p=k(b.reverse().concat(a.chars),c);return p.pop()},dispose:function(){g.dispose();h.dispose();m=p=null}}}function m(a,b,
c,d){var g=a.getRangeBoundaryPosition(b,!0);a=a.getRangeBoundaryPosition(b,!1);return f(d?a:g,!!d,d?g:a,c)}function E(a,b,c,g,h){function k(a,b){var e=m[a].previousVisible(),c=m[b-1],f;if(!(f=!h.wholeWordsOnly)){var n=h.wordOptions;f=d.createRange(e.node);f.setStartAndEnd(e.node,e.offset,c.node,c.offset);n=!f.expand("word",n);f.detach();f=n}return{startPos:e,endPos:c,valid:f}}var l=M(h.direction);a=f(a,l,a.session.getRangeBoundaryPosition(g,l),h);g="";for(var m=[],p,q,r,t,s,u=null;p=a.next();)if(q=
p.character,c||h.caseSensitive||(q=q.toLowerCase()),l?(m.unshift(p),g=q+g):(m.push(p),g+=q),c){if(p=b.exec(g))if(s){if(r=p.index,t=r+p[0].length,!l&&t<g.length||l&&0<r){u=k(r,t);break}}else s=!0}else if(-1!=(r=g.indexOf(b))){u=k(r,r+b.length);break}s&&(u=k(r,t));a.dispose();return u}function g(b){return function(){var c=!!Y,d=[Y||a()].concat(H.toArray(arguments)),d=b.apply(this,d);c||h();return d}}function I(a,b){return g(function(c,d,g,h){var k,l;"undefined"==typeof g&&(g=d,d="character");h=w(h,
$);k=w(h.characterOptions,X);var m=t(h.wordOptions);h=a;b&&(h=0<=g,this.collapse(!h));c=c.getRangeBoundaryPosition(this,h);var q=g;g=0;var r=c,s=Math.abs(q);if(0!==q){q=0>q;switch(d){case "character":for(m=f(c,q,null,k);(l=m.next())&&g<s;)++g,r=l;m.dispose();break;case "word":for(var m=p(c,k,m),u=q?m.previousStartToken:m.nextEndToken;(m=u())&&g<s;)m.isWord&&(++g,r=q?m.chars[0]:m.chars[m.chars.length-1]);break;default:throw Error("movePositionBy: unit '"+d+"' not implemented");}q?(r=r.previousVisible(),
g=-g):r&&r.isLeadingSpace&&("word"==d&&(m=f(c,!1,null,k),l=m.next(),m.dispose()),l&&(r=l.previousVisible()))}k=r;l=g;this[h?"setStart":"setEnd"](k.node,k.offset);return l})}function R(a){return g(function(b,c){c=w(c,X);for(var d,f=m(b,this,c,!a),g=0;(d=f.next())&&W.test(d.character);)++g;f.dispose();if(d=0<g)this[a?"moveStart":"moveEnd"]("character",a?g:-g,{characterOptions:c});return d})}function O(a){return g(function(b,c){var d=!1;this.changeEachRange(function(b){d=b[a](c)||d});return d})}var B=
d.dom,H=d.util,N=H.extend,V=B.getBody,P=/^[ \t\f\r\n]+$/,Q=/^[ \t\f\r]+$/,W=/^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/,ca=/^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/,M=d.Selection.isDirectionBackward,S=!1,F=!1;(function(){var a=document.createElement("div");a.contentEditable="true";a.innerHTML="<p>1 </p><p></p>";var b=V(document),c=a.firstChild,f=d.getSelection();b.appendChild(a);f.collapse(c.lastChild,2);f.setStart(c.firstChild,0);a.innerHTML=
"1 <br>";f.collapse(a,2);f.setStart(a.firstChild,0);S=1==(""+f).length;a.innerHTML="1 <p>1</p>";f.collapse(a,2);f.setStart(a.firstChild,0);F=1==(""+f).length;b.removeChild(a);f.removeAllRanges()})();var X={includeBlockContentTrailingSpace:!0,includeSpaceBeforeBr:!0,includeSpaceBeforeBlock:!0,includePreLineTrailingSpace:!0},l={includeBlockContentTrailingSpace:!1,includeSpaceBeforeBr:!S,includeSpaceBeforeBlock:!F,includePreLineTrailingSpace:!0},J={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:!1,
tokenizer:function(a,b){function c(b,d,f){var n=a.slice(b,d);b={isWord:f,chars:n,toString:function(){return n.join("")}};d=0;for(f=n.length;d<f;++d)n[d].token=b;g.push(b)}for(var d=a.join(""),f,g=[],h=0,k;f=b.wordRegex.exec(d);){k=f.index;f=k+f[0].length;k>h&&c(h,k,!1);if(b.includeTrailingSpace)for(;ca.test(a[f]);)++f;c(k,f,!0);h=f}h<a.length&&c(h,a.length,!1);return g}}},K={caseSensitive:!1,withinRange:null,wholeWordsOnly:!1,wrap:!1,direction:"forward",wordOptions:null,characterOptions:null},$={wordOptions:null,
characterOptions:null},Z={wordOptions:null,characterOptions:null,trim:!1,trimStart:!0,trimEnd:!0},ea={wordOptions:null,characterOptions:null,direction:"forward"},L=B.getComputedStyleProperty,T;(function(){var a=document.createElement("table"),b=V(document);b.appendChild(a);T="block"==L(a,"display");b.removeChild(a)})();d.features.tableCssDisplayBlock=T;var aa={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",
tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"};q.prototype={get:function(a){return this.store.hasOwnProperty(a)?this.store[a]:null},set:function(a,b){return this.store[a]=b}};var ba=0,fa=0,U={getPosition:function(a){var b=this.positions;return b.get(a)||b.set(a,new c(this,a))},toString:function(){return"[NodeWrapper("+B.inspectNode(this.node)+")]"}};b.prototype=U;N(U,{isCharacterDataNode:k("isCharacterDataNode",B.isCharacterDataNode,"node"),getNodeIndex:k("nodeIndex",B.getNodeIndex,
"node"),getLength:k("nodeLength",B.getNodeLength,"node"),containsPositions:k("containsPositions",function(a){return B.isCharacterDataNode(a)||!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(a.nodeName)},"node"),isWhitespace:k("isWhitespace",v,"node"),isCollapsedWhitespace:k("isCollapsedWhitespace",A,"node"),getComputedDisplay:k("computedDisplay",x,"node"),isCollapsed:k("collapsed",C,"node"),isIgnored:k("ignored",r,"node"),next:k("nextPos",y,"node"),previous:k("previous",
z,"node"),getTextNodeInfo:k("textNodeInfo",function(a){var b=null,c=!1,d=L(a.parentNode,"whiteSpace"),f="pre-line"==d;if(f)b=Q,c=!0;else if("normal"==d||"nowrap"==d)b=P,c=!0;return{node:a,text:a.data,spaceRegex:b,collapseSpaces:c,preLine:f}},"node"),hasInnerText:k("hasInnerText",function(a,b){for(var c=this.session,d=c.getPosition(a.parentNode,this.getNodeIndex()+1),f=c.getPosition(a,0),c=b?d:f,d=b?f:d;c!==d;){c.prepopulateChar();if(c.isDefinitelyNonEmpty())return!0;c=b?c.previousVisible():c.nextVisible()}return!1},
"node"),isRenderedBlock:k("isRenderedBlock",function(a){a=a.getElementsByTagName("br");for(var b=0,c=a.length;b<c;++b)if(!C(a[b]))return!0;return this.hasInnerText()},"node"),getTrailingSpace:k("trailingSpace",function(a){if("br"!=a.tagName.toLowerCase())switch(this.getComputedDisplay()){case "inline":for(a=a.lastChild;a;){if(!r(a))return 1==a.nodeType?this.session.getNodeWrapper(a).getTrailingSpace():"";a=a.previousSibling}break;case "inline-block":case "inline-table":case "none":case "table-column":case "table-column-group":break;
case "table-cell":return"\t";default:return this.isRenderedBlock(!0)?"\n":""}return""},"node"),getLeadingSpace:k("leadingSpace",function(a){switch(this.getComputedDisplay()){case "inline":case "inline-block":case "inline-table":case "none":case "table-column":case "table-column-group":case "table-cell":break;default:return this.isRenderedBlock(!1)?"\n":""}return""},"node")});U={character:"",characterType:"EMPTY",isBr:!1,prepopulateChar:function(){if(!this.prepopulatedChar){var a=this.node,b=this.offset,
c="",d="EMPTY",f=!1;if(0<b)if(3==a.nodeType){var a=a.data,g=a.charAt(b-1),h=this.nodeWrapper.getTextNodeInfo(),k=h.spaceRegex;h.collapseSpaces?k.test(g)?1<b&&k.test(a.charAt(b-2))||(h.preLine&&"\n"===a.charAt(b)?(c=" ",d="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK"):(c=" ",d="COLLAPSIBLE_SPACE")):(c=g,d="NON_SPACE",f=!0):(c=g,d="UNCOLLAPSIBLE_SPACE",f=!0)}else(g=a.childNodes[b-1])&&1==g.nodeType&&!C(g)&&("br"==g.tagName.toLowerCase()?(c="\n",this.isBr=!0,d="COLLAPSIBLE_SPACE",f=!1):this.checkForTrailingSpace=
!0),c||(b=a.childNodes[b])&&1==b.nodeType&&!C(b)&&(this.checkForLeadingSpace=!0);this.prepopulatedChar=!0;this.character=c;this.characterType=d;this.isCharInvariant=f}},isDefinitelyNonEmpty:function(){var a=this.characterType;return"NON_SPACE"==a||"UNCOLLAPSIBLE_SPACE"==a},resolveLeadingAndTrailingSpaces:function(){this.prepopulatedChar||this.prepopulateChar();if(this.checkForTrailingSpace){var a=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace();a&&(this.isTrailingSpace=
!0,this.character=a,this.characterType="COLLAPSIBLE_SPACE");this.checkForTrailingSpace=!1}if(this.checkForLeadingSpace){if(a=this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace())this.isLeadingSpace=!0,this.character=a,this.characterType="COLLAPSIBLE_SPACE";this.checkForLeadingSpace=!1}},getPrecedingUncollapsedPosition:function(a){for(var b=this,c;b=b.previousVisible();)if(c=b.getCharacter(a),""!==c)return b;return null},getCharacter:function(a){function b(){h||(g=k.getPrecedingUncollapsedPosition(a),
h=!0);return g}this.resolveLeadingAndTrailingSpaces();if(this.isCharInvariant)return this.character;var c=["character",a.includeSpaceBeforeBr,a.includeBlockContentTrailingSpace,a.includePreLineTrailingSpace].join("_"),d=this.cache.get(c);if(null!==d)return d;var d="",f,g,h=!1,k=this;if("COLLAPSIBLE_SPACE"==this.characterType){if(" "!=this.character||b()&&!g.isTrailingSpace&&"\n"!=g.character)if("\n"==this.character&&this.isLeadingSpace)b()&&"\n"!=g.character&&(d="\n");else if(f=this.nextUncollapsed())if(f.isBr?
this.type="TRAILING_SPACE_BEFORE_BR":f.isTrailingSpace&&"\n"==f.character?this.type="TRAILING_SPACE_IN_BLOCK":f.isLeadingSpace&&"\n"==f.character&&(this.type="TRAILING_SPACE_BEFORE_BLOCK"),"\n"===f.character){if("TRAILING_SPACE_BEFORE_BR"!=this.type||a.includeSpaceBeforeBr)if("TRAILING_SPACE_BEFORE_BLOCK"!=this.type||a.includeSpaceBeforeBlock)if("TRAILING_SPACE_IN_BLOCK"!=this.type||!f.isTrailingSpace||a.includeBlockContentTrailingSpace)if("PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK"!=this.type||"NON_SPACE"!=
f.type||a.includePreLineTrailingSpace)"\n"===this.character?f.isTrailingSpace?!this.isTrailingSpace&&this.isBr&&(f.type="TRAILING_LINE_BREAK_AFTER_BR",b()&&g.isLeadingSpace&&"\n"==g.character&&(f.character="")):d="\n":" "===this.character&&(d=" ")}else d=this.character}else"\n"!==this.character||(f=this.nextUncollapsed());this.cache.set(c,d);return d},equals:function(a){return!!a&&this.node===a.node&&this.offset===a.offset},inspect:function(){return"[Position("+B.inspectNode(this.node)+":"+this.offset+
")]"},toString:function(){return this.character}};c.prototype=U;N(U,{next:k("nextPos",function(a){var b=a.nodeWrapper,c=a.node,d=a.offset;a=b.session;if(!c)return null;d==b.getLength()?b=(c=c.parentNode)?b.getNodeIndex()+1:0:b.isCharacterDataNode()?b=d+1:(b=c.childNodes[d],a.getNodeWrapper(b).containsPositions()?(c=b,b=0):b=d+1);return c?a.getPosition(c,b):null}),previous:k("previous",function(a){var b=a.nodeWrapper,c=a.node,d=a.offset;a=b.session;0==d?b=(c=c.parentNode)?b.getNodeIndex():0:b.isCharacterDataNode()?
b=d-1:(b=c.childNodes[d-1],a.getNodeWrapper(b).containsPositions()?(c=b,b=B.getNodeLength(b)):b=d-1);return c?a.getPosition(c,b):null}),nextVisible:k("nextVisible",function(a){var b=a.next();if(!b)return null;a=b.nodeWrapper;var c=b.node;a.isCollapsed()&&(b=a.session.getPosition(c.parentNode,a.getNodeIndex()+1));return b}),nextUncollapsed:k("nextUncollapsed",function(a){for(;a=a.nextVisible();)if(a.resolveLeadingAndTrailingSpaces(),""!==a.character)return a;return null}),previousVisible:k("previousVisible",
function(a){var b=a.previous();if(!b)return null;a=b.nodeWrapper;var c=b.node;a.isCollapsed()&&(b=a.session.getPosition(c.parentNode,a.getNodeIndex()));return b})});var Y=null,da=function(){function a(b){var c=new q;return{get:function(a){var e=c.get(a[b]);if(e)for(var d=0,f;f=e[d++];)if(f.node===a)return f;return null},set:function(a){var e=a.node[b];(c.get(e)||c.set(e,[])).push(a)}}}function c(){this.initCaches()}var d=H.isHostProperty(document.documentElement,"uniqueID");c.prototype={initCaches:function(){this.elementCache=
d?function(){var a=new q;return{get:function(b){return a.get(b.uniqueID)},set:function(b){a.set(b.node.uniqueID,b)}}}():a("tagName");this.textNodeCache=a("data");this.otherNodeCache=a("nodeName")},getNodeWrapper:function(a){var c;switch(a.nodeType){case 1:c=this.elementCache;break;case 3:c=this.textNodeCache;break;default:c=this.otherNodeCache}var e=c.get(a);e||(e=new b(a,this),c.set(e));return e},getPosition:function(a,b){return this.getNodeWrapper(a).getPosition(b)},getRangeBoundaryPosition:function(a,
b){var c=b?"start":"end";return this.getPosition(a[c+"Container"],a[c+"Offset"])},detach:function(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}};return c}();N(B,{nextNode:y,previousNode:z});var s=Array.prototype.indexOf?function(a,b){return a.indexOf(b)}:function(a,b){for(var c=0,d=a.length;c<d;++c)if(a[c]===b)return c;return-1};N(d.rangePrototype,{moveStart:I(!0,!1),moveEnd:I(!1,!1),move:I(!0,!0),trimStart:R(!0),trimEnd:R(!1),trim:g(function(a,b){var c=this.trimStart(b),d=this.trimEnd(b);
return c||d}),expand:g(function(a,b,c){var d=!1;c=w(c,Z);var f=w(c.characterOptions,X);b||(b="character");if("word"==b){var g=t(c.wordOptions);b=a.getRangeBoundaryPosition(this,!0);a=a.getRangeBoundaryPosition(this,!1);var h=p(b,f,g).nextEndToken(),k=h.chars[0].previousVisible(),g=this.collapsed?h:p(a,f,g).previousStartToken(),g=g.chars[g.chars.length-1];k.equals(b)||(this.setStart(k.node,k.offset),d=!0);g&&!g.equals(a)&&(this.setEnd(g.node,g.offset),d=!0);c.trim&&(c.trimStart&&(d=this.trimStart(f)||
d),c.trimEnd&&(d=this.trimEnd(f)||d));return d}return this.moveEnd("character",1,c)}),text:g(function(a,b){var c;if(this.collapsed)c="";else{var d=w(b,X);c=[];for(var d=m(a,this,d),f;f=d.next();)c.push(f);d.dispose();c=c.join("")}return c}),selectCharacters:g(function(a,b,c,d,f){a={characterOptions:f};b||(b=V(this.getDocument()));this.selectNodeContents(b);this.collapse(!0);this.moveStart("character",c,a);this.collapse(!0);this.moveEnd("character",d-c,a)}),toCharacterRange:g(function(a,b,c){b||(b=
V(this.getDocument()));a=b.parentNode;b=B.getNodeIndex(b);var d=-1==B.comparePoints(this.startContainer,this.endContainer,a,b),f=this.cloneRange();d?(f.setStartAndEnd(this.startContainer,this.startOffset,a,b),a=-f.text(c).length):(f.setStartAndEnd(a,b,this.startContainer,this.startOffset),a=f.text(c).length);c=a+this.text(c).length;return{start:a,end:c}}),findText:g(function(a,b,c){c=w(c,K);c.wholeWordsOnly&&(c.wordOptions=t(c.wordOptions),c.wordOptions.includeTrailingSpace=!1);var f=M(c.direction),
g=c.withinRange;g||(g=d.createRange(),g.selectNodeContents(this.getDocument()));var h=!1;"string"==typeof b?c.caseSensitive||(b=b.toLowerCase()):h=!0;var k=a.getRangeBoundaryPosition(this,!f),l=g.comparePoint(k.node,k.offset);-1===l?k=a.getRangeBoundaryPosition(g,!0):1===l&&(k=a.getRangeBoundaryPosition(g,!1));for(var m=k,l=!1;;)if(m=E(m,b,h,g,c)){if(m.valid)return this.setStartAndEnd(m.startPos.node,m.startPos.offset,m.endPos.node,m.endPos.offset),!0;m=f?m.startPos:m.endPos}else if(c.wrap&&!l)g=
g.cloneRange(),m=a.getRangeBoundaryPosition(g,!f),g.setBoundary(k.node,k.offset,f),l=!0;else return!1}),pasteHtml:function(a){this.deleteContents();if(a){a=this.createContextualFragment(a);var b=a.lastChild;this.insertNode(a);this.collapseAfter(b)}}});N(d.selectionPrototype,{expand:g(function(a,b,c){this.changeEachRange(function(a){a.expand(b,c)})}),move:g(function(a,b,c,d){a=0;if(this.focusNode){this.collapse(this.focusNode,this.focusOffset);var f=this.getRangeAt(0);d||(d={});d.characterOptions=
w(d.characterOptions,l);a=f.move(b,c,d);this.setSingleRange(f)}return a}),trimStart:O("trimStart"),trimEnd:O("trimEnd"),trim:O("trim"),selectCharacters:g(function(a,b,c,f,g,h){a=d.createRange(b);a.selectCharacters(b,c,f,h);this.setSingleRange(a,g)}),saveCharacterRanges:g(function(a,b,c){a=this.getAllRanges();for(var d=[],f=1==a.length&&this.isBackward(),g=0,h=a.length;g<h;++g)d[g]={characterRange:a[g].toCharacterRange(b,c),backward:f,characterOptions:c};return d}),restoreCharacterRanges:g(function(a,
b,c){this.removeAllRanges();a=0;for(var f=c.length,g,h,k;a<f;++a)h=c[a],k=h.characterRange,g=d.createRange(b),g.selectCharacters(b,k.start,k.end,h.characterOptions),this.addRange(g,h.backward)}),text:g(function(a,b){for(var c=[],d=0,f=this.rangeCount;d<f;++d)c[d]=this.getRangeAt(d).text(b);return c.join("")})});d.innerText=function(a,b){var c=d.createRange(a);c.selectNodeContents(a);var f=c.text(b);c.detach();return f};d.createWordIterator=function(b,c,d){var f=Y||a();d=w(d,ea);var g=w(d.characterOptions,
X),h=t(d.wordOptions);b=f.getPosition(b,c);var k=p(b,g,h),l=M(d.direction);return{next:function(){return l?k.previousStartToken():k.nextEndToken()},dispose:function(){k.dispose();this.next=function(){}}}};d.noMutation=function(b){var c=Y||a();b(c);h()};d.noMutation.createEntryPointFunction=g;d.textRange={isBlockNode:function(a){return a&&(1==a.nodeType&&!/^(inline(-block|-table)?|none)$/.test(x(a))||9==a.nodeType||11==a.nodeType)},isCollapsedWhitespaceNode:A,createPosition:g(function(a,b,c){return a.getPosition(b,
c)})}});




var highlighter;
window.onload = function () {
	rangy.init();
	highlighter = rangy.createHighlighter();
	highlighter.addClassApplier(rangy.createClassApplier("highlight", {ingoreWhiteSpace:true,elementTagname: "span"}));
}

annotation.highlight_selected_text = function()
{
	var highlight = highlighter.highlightSelection("highlight")[0];
    // create a json object containing highlight information
    var highlightJSON = {};
    highlightJSON['text']=rangy.getSelection().toString();
    highlightJSON['start']=highlight.characterRange.start;
    highlightJSON['end'] = highlight.characterRange.end;
	return highlightJSON;
}
annotation.remove_all_highlights = function () {
	highlighter.removeAllHighlights();
}
annotation.highlight_next_annotation = function (start, end, id) {
	highlighter.removeAllHighlights();
    var serializedHighlights='type:textContent|'+start+'$'+end+'$'+id+'$highlight';
    highlighter.deserialize(serializedHighlights);
}
annotation.get_body_content = function(start, end) {
	if (start>=end) {return ""}
	var node = document.body;
	var range = rangy.createRange();
	range.setStart(node,0);
	range.setEnd(node, node.childNodes.length);
	var content = range.toString();
	return content.length>=end ? content.substring(start,end) : content.substring(start,content.length);
}
